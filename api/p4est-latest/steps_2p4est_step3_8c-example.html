<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>p4est: steps/p4est_step3.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">p4est
   &#160;<span id="projectnumber">2.8.6.259-54a6</span>
   </div>
   <div id="projectbrief">p4est is a software library for parallel adaptive mesh refinement.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">steps/p4est_step3.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>This 2D example program (3D counterpart: <a class="el" href="steps_2p8est_step3_8c-example.html">steps/p8est_step3.c</a>) uses <a class="el" href="structp4est.html" title="The p4est forest datatype.">p4est</a> to solve a simple advection problem.It is numerically very simple, and intended to demonstrate several methods of interacting with the <a class="el" href="structp4est.html" title="The p4est forest datatype.">p4est</a> data after it has been refined and partitioned. It demonstrates the construction of <a class="el" href="ghost.html">ghost</a> layers (cf. also <a class="el" href="p4est__ghost_8h.html">p4est_ghost.h</a>) and communication of ghost-layer data, and it demonstrates interacting with the quadrants and quadrant boundaries through the <a class="el" href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a> routine (cf. <a class="el" href="p4est__iterate_8h.html">p4est_iterate.h</a>).</p>
<p>Usage: </p><blockquote class="doxtable">
<p><code>p4est_step3</code> </p>
</blockquote>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">  This file is part of p4est.</span></div>
<div class="line"><span class="comment">  p4est is a C library to manage a collection (a forest) of multiple</span></div>
<div class="line"><span class="comment">  connected adaptive quadtrees or octrees in parallel.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  Copyright (C) 2010 The University of Texas System</span></div>
<div class="line"><span class="comment">  Additional copyright (C) 2011 individual authors</span></div>
<div class="line"><span class="comment">  Written by Carsten Burstedde, Lucas C. Wilcox, and Tobin Isaac</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  p4est is free software; you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment">  it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><span class="comment">  the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><span class="comment">  (at your option) any later version.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  p4est is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment">  GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment">  along with p4est; if not, write to the Free Software Foundation, Inc.,</span></div>
<div class="line"><span class="comment">  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* p4est has two separate interfaces for 2D and 3D, p4est*.h and p8est*.h.</span></div>
<div class="line"><span class="comment"> * Most API functions are available for both dimensions.  The header file</span></div>
<div class="line"><span class="comment"> * p4est_to_p8est.h #define&#39;s the 2D names to the 3D names such that most code</span></div>
<div class="line"><span class="comment"> * only needs to be written once.  In this example, we rely on this. */</span></div>
<div class="line"><span class="preprocessor">#ifndef P4_TO_P8</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__vtk_8h.html">p4est_vtk.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__bits_8h.html">p4est_bits.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__extended_8h.html">p4est_extended.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__iterate_8h.html">p4est_iterate.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__io_8h.html">p4est_io.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__communication_8h.html">p4est_communication.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__vtk_8h.html">p8est_vtk.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__bits_8h.html">p8est_bits.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__extended_8h.html">p8est_extended.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__iterate_8h.html">p8est_iterate.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__io_8h.html">p8est_io.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__communication_8h.html">p8est_communication.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#include &lt;sc_options.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* The file format and API for checkpoint load/save will change */</span></div>
<div class="line"><span class="preprocessor">#ifdef P4EST_ENABLE_FILE_DEPRECATED</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifndef P4_TO_P8</span></div>
<div class="line"><span class="preprocessor">#define P4EST_DATA_FILE_EXT &quot;p4d&quot;</span> </div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#define P4EST_DATA_FILE_EXT               P8EST_DATA_FILE_EXT</span></div>
<div class="line"><span class="preprocessor">#define P8EST_DATA_FILE_EXT &quot;p8d&quot;</span> </div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#define STEP3_BLOCK_SIZE (sizeof (step3_ctx_t)) </span></div>
<div class="line"><span class="preprocessor">#define STEP3_ENDIAN_CHECK 0x30415062   </span><span class="comment">/* check endian; bPA0 in ASCII */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* P4EST_ENABLE_FILE_DEPRECATED */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">double</span> step3_invalid = -1.;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef P4EST_ENABLE_FILE_DEPRECATED</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span>          step3_checkpoint = 0;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* P4EST_ENABLE_FILE_DEPRECATED */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* In this example we store data with each quadrant/octant. */</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>step3_data</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">double</span>              u;             </div>
<div class="line">  <span class="keywordtype">double</span>              du[<a name="a0"></a><a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>]; </div>
<div class="line">  <span class="keywordtype">double</span>              dudt;          </div>
<div class="line">}</div>
<div class="line">step3_data_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>step3_ctx</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">double</span>              center[<a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>];  </div>
<div class="line">  <span class="keywordtype">double</span>              bump_width;         </div>
<div class="line">  <span class="keywordtype">double</span>              max_err;            </div>
<div class="line">  <span class="keywordtype">double</span>              v[<a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>];       </div>
<div class="line">  <span class="keywordtype">int</span>                 refine_period;      </div>
<div class="line">  <span class="keywordtype">int</span>                 repartition_period; </div>
<div class="line">  <span class="keywordtype">int</span>                 write_period;       </div>
<div class="line">  <span class="keywordtype">double</span>              current_time;       </div>
<div class="line">  <span class="keywordtype">int</span>                 time_step;          </div>
<div class="line">}</div>
<div class="line">step3_ctx_t;</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span></div>
<div class="line">step3_initial_condition (<span class="keywordtype">double</span> x[], <span class="keywordtype">double</span> du[], step3_ctx_t * ctx)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 i;</div>
<div class="line">  <span class="keywordtype">double</span>             *c = ctx-&gt;center;</div>
<div class="line">  <span class="keywordtype">double</span>              bump_width = ctx-&gt;bump_width;</div>
<div class="line">  <span class="keywordtype">double</span>              r2, d[<a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>];</div>
<div class="line">  <span class="keywordtype">double</span>              arg, retval;</div>
<div class="line"> </div>
<div class="line">  r2 = 0.;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>; i++) {</div>
<div class="line">    d[i] = x[i] - c[i];</div>
<div class="line">    r2 += d[i] * d[i];</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  arg = -(1. / 2.) * r2 / bump_width / bump_width;</div>
<div class="line">  retval = exp (arg);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (du) {</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>; i++) {</div>
<div class="line">      du[i] = -(1. / bump_width / bump_width) * d[i] * retval;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> retval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_get_midpoint (<a name="_a1"></a><a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                    <a name="_a2"></a><a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * q, <span class="keywordtype">double</span> xyz[3])</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="p4est__base_8h.html#a05ea8ceb664ae2403fbcf7b1dcc70ea0">p4est_qcoord_t</a>      half_length = <a name="a3"></a><a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (q-&gt;<a name="a4"></a><a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / 2;</div>
<div class="line"> </div>
<div class="line">  <a name="a5"></a><a class="code" href="p4est_8h.html#a90acb1ef22be84e31afdec64aab60567">p4est_qcoord_to_vertex</a> (<a class="code" href="structp4est.html">p4est</a>-&gt;<a name="a6"></a><a class="code" href="structp4est.html#a2ca31d19479e82d49a7dd3a4f2d48011">connectivity</a>, which_tree,</div>
<div class="line">                          q-&gt;<a name="a7"></a>x + half_length, q-&gt;<a name="a8"></a><a class="code" href="structp4est__quadrant.html#ad226034132b973fe7955ef797938dea0">y</a> + half_length,</div>
<div class="line">#ifdef P4_TO_P8</div>
<div class="line">                          q-&gt;z + half_length,</div>
<div class="line">#endif</div>
<div class="line">                          xyz);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_init_initial_condition (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                              <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * q)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* the data associated with a forest is accessible by user_pointer */</span></div>
<div class="line">  step3_ctx_t        *ctx = (step3_ctx_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a name="a9"></a><a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line">  <span class="comment">/* the data associated with a quadrant is accessible by p.user_data */</span></div>
<div class="line">  step3_data_t       *data = (step3_data_t *) q-&gt;<a name="a10"></a><a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a name="a11"></a><a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">  <span class="keywordtype">double</span>              midpoint[3];</div>
<div class="line"> </div>
<div class="line">  step3_get_midpoint (<a class="code" href="structp4est.html">p4est</a>, which_tree, q, midpoint);</div>
<div class="line">  <span class="comment">/* initialize the data */</span></div>
<div class="line">  data-&gt;u = step3_initial_condition (midpoint, data-&gt;du, ctx);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span></div>
<div class="line">step3_error_sqr_estimate (<a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * q)</div>
<div class="line">{</div>
<div class="line">  step3_data_t       *data = (step3_data_t *) q-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                 i;</div>
<div class="line">  <span class="keywordtype">double</span>              diff2;</div>
<div class="line">  <span class="keywordtype">double</span>             *du = data-&gt;du;</div>
<div class="line">  <span class="keywordtype">double</span>              h =</div>
<div class="line">    (<span class="keywordtype">double</span>) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (q-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / (double) <a name="a12"></a><a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line">  <span class="keywordtype">double</span>              vol;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef P4_TO_P8</span></div>
<div class="line">  vol = h * h * h;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  vol = h * h;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  diff2 = 0.;</div>
<div class="line">  <span class="comment">/* use the approximate derivative to estimate the L2 error */</span></div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>; i++) {</div>
<div class="line">    diff2 += du[i] * du[i] * (1. / 12.) * h * h * vol;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> diff2;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">step3_refine_err_estimate (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                           <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * q)</div>
<div class="line">{</div>
<div class="line">  step3_ctx_t        *ctx = (step3_ctx_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line">  <span class="keywordtype">double</span>              global_err = ctx-&gt;max_err;</div>
<div class="line">  <span class="keywordtype">double</span>              global_err2 = global_err * global_err;</div>
<div class="line">  <span class="keywordtype">double</span>              h =</div>
<div class="line">    (<span class="keywordtype">double</span>) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (q-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line">  <span class="keywordtype">double</span>              vol, err2;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* the quadrant&#39;s volume is also its volume fraction */</span></div>
<div class="line"><span class="preprocessor">#ifdef P4_TO_P8</span></div>
<div class="line">  vol = h * h * h;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  vol = h * h;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  err2 = step3_error_sqr_estimate (q);</div>
<div class="line">  <span class="keywordflow">if</span> (err2 &gt; global_err2 * vol) {</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">step3_coarsen_initial_condition (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>,</div>
<div class="line">                                 <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                                 <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * children[])</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a>    parent;</div>
<div class="line">  step3_ctx_t        *ctx = (step3_ctx_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line">  <span class="keywordtype">double</span>              global_err = ctx-&gt;max_err;</div>
<div class="line">  <span class="keywordtype">double</span>              global_err2 = global_err * global_err;</div>
<div class="line">  <span class="keywordtype">double</span>              h;</div>
<div class="line">  step3_data_t        parentdata;</div>
<div class="line">  <span class="keywordtype">double</span>              parentmidpoint[3];</div>
<div class="line">  <span class="keywordtype">double</span>              vol, err2;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* get the parent of the first child (the parent of all children) */</span></div>
<div class="line">  <a name="a13"></a><a class="code" href="p4est__bits_8h.html#abf3fcf47f480c00a590f005807c71b9b">p4est_quadrant_parent</a> (children[0], &amp;parent);</div>
<div class="line">  step3_get_midpoint (<a class="code" href="structp4est.html">p4est</a>, which_tree, &amp;parent, parentmidpoint);</div>
<div class="line">  parentdata.u = step3_initial_condition (parentmidpoint, parentdata.du, ctx);</div>
<div class="line">  h = (double) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (parent.<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line">  <span class="comment">/* the quadrant&#39;s volume is also its volume fraction */</span></div>
<div class="line"><span class="preprocessor">#ifdef P4_TO_P8</span></div>
<div class="line">  vol = h * h * h;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  vol = h * h;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  parent.<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a> = (<span class="keywordtype">void</span> *) (&amp;parentdata);</div>
<div class="line"> </div>
<div class="line">  err2 = step3_error_sqr_estimate (&amp;parent);</div>
<div class="line">  <span class="keywordflow">if</span> (err2 &lt; global_err2 * vol) {</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">step3_coarsen_err_estimate (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>,</div>
<div class="line">                            <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                            <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * children[])</div>
<div class="line">{</div>
<div class="line">  step3_ctx_t        *ctx = (step3_ctx_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line">  <span class="keywordtype">double</span>              global_err = ctx-&gt;max_err;</div>
<div class="line">  <span class="keywordtype">double</span>              global_err2 = global_err * global_err;</div>
<div class="line">  <span class="keywordtype">double</span>              h;</div>
<div class="line">  step3_data_t       *data;</div>
<div class="line">  <span class="keywordtype">double</span>              vol, err2, childerr2;</div>
<div class="line">  <span class="keywordtype">double</span>              parentu;</div>
<div class="line">  <span class="keywordtype">double</span>              diff;</div>
<div class="line">  <span class="keywordtype">int</span>                 i;</div>
<div class="line"> </div>
<div class="line">  h =</div>
<div class="line">    (<span class="keywordtype">double</span>) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (children[0]-&gt;level) /</div>
<div class="line">    (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line">  <span class="comment">/* the quadrant&#39;s volume is also its volume fraction */</span></div>
<div class="line"><span class="preprocessor">#ifdef P4_TO_P8</span></div>
<div class="line">  vol = h * h * h;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  vol = h * h;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* compute the average */</span></div>
<div class="line">  parentu = 0.;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <a name="a14"></a><a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; i++) {</div>
<div class="line">    data = (step3_data_t *) children[i]-&gt;p.user_data;</div>
<div class="line">    parentu += data-&gt;u / <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  err2 = 0.;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; i++) {</div>
<div class="line">    childerr2 = step3_error_sqr_estimate (children[i]);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (childerr2 &gt; global_err2 * vol) {</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">    err2 += step3_error_sqr_estimate (children[i]);</div>
<div class="line">    diff = (parentu - data-&gt;u) * (parentu - data-&gt;u);</div>
<div class="line">    err2 += diff * vol;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (err2 &lt; global_err2 * (vol * <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>)) {</div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_replace_quads (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                     <span class="keywordtype">int</span> num_outgoing,</div>
<div class="line">                     <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * outgoing[],</div>
<div class="line">                     <span class="keywordtype">int</span> num_incoming, <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * incoming[])</div>
<div class="line">{</div>
<div class="line">  step3_data_t       *parent_data, *child_data;</div>
<div class="line">  <span class="keywordtype">int</span>                 i, j;</div>
<div class="line">  <span class="keywordtype">double</span>              h;</div>
<div class="line">  <span class="keywordtype">double</span>              du_old, du_est;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (num_outgoing &gt; 1) {</div>
<div class="line">    <span class="comment">/* this is coarsening */</span></div>
<div class="line">    parent_data = (step3_data_t *) incoming[0]-&gt;p.user_data;</div>
<div class="line">    parent_data-&gt;u = 0.;</div>
<div class="line">    for (j = 0; j &lt; <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>; j++) {</div>
<div class="line">      parent_data-&gt;du[j] = step3_invalid;</div>
<div class="line"> </div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; i++) {</div>
<div class="line">      child_data = (step3_data_t *) outgoing[i]-&gt;p.user_data;</div>
<div class="line">      parent_data-&gt;u += child_data-&gt;u / <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>;</div>
<div class="line">      for (j = 0; j &lt; <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>; j++) {</div>
<div class="line">        du_old = parent_data-&gt;du[j];</div>
<div class="line">        du_est = child_data-&gt;du[j];</div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (du_old == du_old) {</div>
<div class="line">          <span class="keywordflow">if</span> (du_est * du_old &gt;= 0.) {</div>
<div class="line">            <span class="keywordflow">if</span> (fabs (du_est) &lt; fabs (du_old)) {</div>
<div class="line">              parent_data-&gt;du[j] = du_est;</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">else</span> {</div>
<div class="line">            parent_data-&gt;du[j] = 0.;</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">          parent_data-&gt;du[j] = du_est;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">/* this is refinement */</span></div>
<div class="line">    parent_data = (step3_data_t *) outgoing[0]-&gt;p.user_data;</div>
<div class="line">    h =</div>
<div class="line">      (<span class="keywordtype">double</span>) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (outgoing[0]-&gt;level) /</div>
<div class="line">      (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; i++) {</div>
<div class="line">      child_data = (step3_data_t *) incoming[i]-&gt;p.user_data;</div>
<div class="line">      child_data-&gt;u = parent_data-&gt;u;</div>
<div class="line">      for (j = 0; j &lt; <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>; j++) {</div>
<div class="line">        child_data-&gt;du[j] = parent_data-&gt;du[j];</div>
<div class="line">        child_data-&gt;u +=</div>
<div class="line">          (h / 4.) * parent_data-&gt;du[j] * ((i &amp; (1 &lt;&lt; j)) ? 1. : -1);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_interpolate_solution (<a name="_a15"></a><a class="code" href="structp4est__iter__volume__info.html">p4est_iter_volume_info_t</a> * info, <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  sc_array_t         *u_interp = (sc_array_t *) user_data;      <span class="comment">/* we passed the array of values to fill as the user_data in the call to p4est_iterate */</span></div>
<div class="line">  <a class="code" href="structp4est.html">p4est_t</a>            *<a class="code" href="structp4est.html">p4est</a> = info-&gt;<a name="a16"></a>p4est;</div>
<div class="line">  <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a>   *q = info-&gt;<a name="a17"></a><a class="code" href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">quad</a>;</div>
<div class="line">  <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a>      which_tree = info-&gt;<a name="a18"></a><a class="code" href="structp4est__iter__volume__info.html#aa9203b989bb29cc3ff536dd224727ab4">treeid</a>;</div>
<div class="line">  <a class="code" href="p4est__base_8h.html#a9f350ee78755ec6e7d25fb1dca474573">p4est_locidx_t</a>      local_id = info-&gt;<a name="a19"></a><a class="code" href="structp4est__iter__volume__info.html#a47f7123c64fa71ba536b971525d9678e">quadid</a>;  <span class="comment">/* this is the index of q *within its tree&#39;s numbering*.  We want to convert it its index for all the quadrants on this process, which we do below */</span></div>
<div class="line">  <a name="_a20"></a><a class="code" href="structp4est__tree.html">p4est_tree_t</a>       *tree;</div>
<div class="line">  step3_data_t       *data = (step3_data_t *) q-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">  <span class="keywordtype">double</span>              h;</div>
<div class="line">  <a class="code" href="p4est__base_8h.html#a9f350ee78755ec6e7d25fb1dca474573">p4est_locidx_t</a>      arrayoffset;</div>
<div class="line">  <span class="keywordtype">double</span>              this_u;</div>
<div class="line">  <span class="keywordtype">double</span>             *this_u_ptr;</div>
<div class="line">  <span class="keywordtype">int</span>                 i, j;</div>
<div class="line"> </div>
<div class="line">  tree = p4est_tree_array_index (<a class="code" href="structp4est.html">p4est</a>-&gt;<a name="a21"></a><a class="code" href="structp4est.html#a6158d35a403f1dbec23833746c5b4a8b">trees</a>, which_tree);</div>
<div class="line">  local_id += tree-&gt;<a name="a22"></a><a class="code" href="structp4est__tree.html#ab0248e174f0d63c76bbe1ba955f732be">quadrants_offset</a>;   <span class="comment">/* now the id is relative to the MPI process */</span></div>
<div class="line">  arrayoffset = <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a> * local_id;      <span class="comment">/* each local quadrant has 2^d (P4EST_CHILDREN) values in u_interp */</span></div>
<div class="line">  h = (double) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (q-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; i++) {</div>
<div class="line">    this_u = data-&gt;u;</div>
<div class="line">    <span class="comment">/* loop over the derivative components and linearly interpolate from the</span></div>
<div class="line"><span class="comment">     * midpoint to the corners */</span></div>
<div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>; j++) {</div>
<div class="line">      <span class="comment">/* In order to know whether the direction from the midpoint to the corner is</span></div>
<div class="line"><span class="comment">       * negative or positive, we take advantage of the fact that the corners</span></div>
<div class="line"><span class="comment">       * are in z-order.  If i is an odd number, it is on the +x side; if it</span></div>
<div class="line"><span class="comment">       * is even, it is on the -x side.  If (i / 2) is an odd number, it is on</span></div>
<div class="line"><span class="comment">       * the +y side, etc. */</span></div>
<div class="line">      this_u += (h / 2) * data-&gt;du[j] * ((i &amp; (1 &lt;&lt; j)) ? 1. : -1.);</div>
<div class="line">    }</div>
<div class="line">    this_u_ptr = (<span class="keywordtype">double</span> *) sc_array_index (u_interp, arrayoffset + i);</div>
<div class="line">    this_u_ptr[0] = this_u;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_write_solution (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>, <span class="keywordtype">int</span> timestep)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span>                filename[BUFSIZ] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">  <span class="keywordtype">int</span>                 retval;</div>
<div class="line">  sc_array_t         *u_interp;</div>
<div class="line">  <a class="code" href="p4est__base_8h.html#a9f350ee78755ec6e7d25fb1dca474573">p4est_locidx_t</a>      numquads;</div>
<div class="line">  <a class="code" href="p4est__vtk_8h.html#aec7e360e192839f06f58cbfc7afb6d6c">p4est_vtk_context_t</a> *context;</div>
<div class="line"> </div>
<div class="line">  snprintf (filename, BUFSIZ, <a name="a23"></a><a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_step3_%04d&quot;</span>, timestep);</div>
<div class="line"> </div>
<div class="line">  numquads = <a class="code" href="structp4est.html">p4est</a>-&gt;<a name="a24"></a><a class="code" href="structp4est.html#a40324cbcc175d48f887735afd5c4239f">local_num_quadrants</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* create a vector with one value for the corner of every local quadrant</span></div>
<div class="line"><span class="comment">   * (the number of children is always the same as the number of corners) */</span></div>
<div class="line">  u_interp = sc_array_new_size (<span class="keyword">sizeof</span> (<span class="keywordtype">double</span>), numquads * <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Use the iterator to visit every cell and fill in the solution values.</span></div>
<div class="line"><span class="comment">   * Using the iterator is not absolutely necessary in this case: we could</span></div>
<div class="line"><span class="comment">   * also loop over every tree (there is only one tree in this case) and loop</span></div>
<div class="line"><span class="comment">   * over every quadrant within every tree, but we are trying to demonstrate</span></div>
<div class="line"><span class="comment">   * the usage of p4est_iterate in this example */</span></div>
<div class="line">  <a name="a25"></a><a class="code" href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a> (<a class="code" href="structp4est.html">p4est</a>, NULL,   <span class="comment">/* we don&#39;t need any ghost quadrants for this loop */</span></div>
<div class="line">                 (<span class="keywordtype">void</span> *) u_interp,     <span class="comment">/* pass in u_interp so that we can fill it */</span></div>
<div class="line">                 step3_interpolate_solution,    <span class="comment">/* callback function that interpolates from the cell center to the cell corners, defined above */</span></div>
<div class="line">                 NULL,          <span class="comment">/* there is no callback for the faces between quadrants */</span></div>
<div class="line">#ifdef P4_TO_P8</div>
<div class="line">                 NULL,          <span class="comment">/* there is no callback for the edges between quadrants */</span></div>
<div class="line">#endif</div>
<div class="line">                 NULL);         <span class="comment">/* there is no callback for the corners between quadrants */</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* create VTK output context and set its parameters */</span></div>
<div class="line">  context = <a name="a26"></a><a class="code" href="p4est__vtk_8h.html#a34dbafa8dbc61172ead1a4da4c7103ca">p4est_vtk_context_new</a> (<a class="code" href="structp4est.html">p4est</a>, filename);</div>
<div class="line">  <a name="a27"></a><a class="code" href="p4est__vtk_8h.html#aa6d374056a42e8bf6245cf0789e117c0">p4est_vtk_context_set_scale</a> (context, 0.99);  <span class="comment">/* quadrant at almost full scale */</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* begin writing the output files */</span></div>
<div class="line">  context = <a name="a28"></a><a class="code" href="p4est__vtk_8h.html#a17ce523f11f580944630c6c604a070da">p4est_vtk_write_header</a> (context);</div>
<div class="line">  SC_CHECK_ABORT (context != NULL,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_vtk: Error writing vtk header&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* do not write the tree id&#39;s of each quadrant</span></div>
<div class="line"><span class="comment">   * (there is only one tree in this example) */</span></div>
<div class="line">  context = <a name="a29"></a><a class="code" href="p4est__vtk_8h.html#a7120e8be889eed8a43a781db9f12f00a">p4est_vtk_write_cell_dataf</a> (context, 0, 1,  <span class="comment">/* do write the refinement level of each quadrant */</span></div>
<div class="line">                                        1,      <span class="comment">/* do write the mpi process id of each quadrant */</span></div>
<div class="line">                                        0,      <span class="comment">/* do not wrap the mpi rank (if this were &gt; 0, the modulus of the rank relative to this number would be written instead of the rank) */</span></div>
<div class="line">                                        0,      <span class="comment">/* there is no custom cell scalar data. */</span></div>
<div class="line">                                        0,      <span class="comment">/* there is no custom cell vector data. */</span></div>
<div class="line">                                        context);       <span class="comment">/* mark the end of the variable cell data. */</span></div>
<div class="line">  SC_CHECK_ABORT (context != NULL,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_vtk: Error writing cell data&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write one scalar field: the solution value */</span></div>
<div class="line">  context = <a name="a30"></a><a class="code" href="p4est__vtk_8h.html#a16f7a68833130a721eea8dab489cd69f">p4est_vtk_write_point_dataf</a> (context, 1, 0, <span class="comment">/* write no vector fields */</span></div>
<div class="line">                                         <span class="stringliteral">&quot;solution&quot;</span>, u_interp, context);        <span class="comment">/* mark the end of the variable cell data. */</span></div>
<div class="line">  SC_CHECK_ABORT (context != NULL,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_vtk: Error writing cell data&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  retval = <a name="a31"></a><a class="code" href="p4est__vtk_8h.html#a23950ebd8b9b99877fa152752b5150d4">p4est_vtk_write_footer</a> (context);</div>
<div class="line">  SC_CHECK_ABORT (!retval, <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_vtk: Error writing footer&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  sc_array_destroy (u_interp);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef P4EST_ENABLE_FILE_DEPRECATED</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_write_checkpoint (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>, <span class="keywordtype">int</span> timestep)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">char</span>                filename[BUFSIZ] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">  <span class="keywordtype">char</span>                user_string[P4EST_FILE_USER_STRING_BYTES] = <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">  <span class="keywordtype">char</span>                quad_data_user_string[P4EST_FILE_USER_STRING_BYTES] =</div>
<div class="line">    <span class="stringliteral">&quot;&quot;</span>;</div>
<div class="line">  <span class="keywordtype">int</span>                 errcode;</div>
<div class="line">  p4est_file_context_t *fc;</div>
<div class="line">  uint32_t            check_endianness = STEP3_ENDIAN_CHECK;</div>
<div class="line">  sc_array_t          block_arr;</div>
<div class="line"> </div>
<div class="line">  snprintf (filename, BUFSIZ,</div>
<div class="line">            <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_step3_checkpoint%04d.&quot;</span> P4EST_DATA_FILE_EXT,</div>
<div class="line">            timestep);</div>
<div class="line"> </div>
<div class="line">  fc = p4est_file_open_create (<a class="code" href="structp4est.html">p4est</a>, filename, <span class="stringliteral">&quot;Checkpoint file&quot;</span>, &amp;errcode);</div>
<div class="line">  <span class="comment">/* One could use the error codes in \ref p4est_io.h and \ref p4est_file_error_string</span></div>
<div class="line"><span class="comment">   * for more sophisticated error handling.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_file_open_create: Error creating file&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  snprintf (user_string, P4EST_FILE_USER_STRING_BYTES, <span class="stringliteral">&quot;%s&quot;</span>, <span class="stringliteral">&quot;Endianness&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  sc_array_init_data (&amp;block_arr, &amp;check_endianness, <span class="keyword">sizeof</span> (uint32_t), 1);</div>
<div class="line">  <span class="comment">/* write data to check endianness */</span></div>
<div class="line">  fc =</div>
<div class="line">    p4est_file_write_block (fc, <span class="keyword">sizeof</span> (uint32_t), &amp;block_arr,</div>
<div class="line">                            user_string, &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_file_write_block: Error writing endianness&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  snprintf (user_string, P4EST_FILE_USER_STRING_BYTES, <span class="stringliteral">&quot;%s&quot;</span>,</div>
<div class="line">            <span class="stringliteral">&quot;Simulation context&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  sc_array_init_data (&amp;block_arr, <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>, STEP3_BLOCK_SIZE, 1);</div>
<div class="line">  <span class="comment">/* write the simulation context */</span></div>
<div class="line">  fc =</div>
<div class="line">    p4est_file_write_block (fc, STEP3_BLOCK_SIZE, &amp;block_arr,</div>
<div class="line">                            user_string, &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a></div>
<div class="line">                  <span class="stringliteral">&quot;_file_write_block: Error writing simulation context&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  snprintf (user_string, P4EST_FILE_USER_STRING_BYTES,</div>
<div class="line">            <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot; connecitivity&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write connectivity of the p4est */</span></div>
<div class="line">  fc =</div>
<div class="line">    p4est_file_write_connectivity (fc, <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a2ca31d19479e82d49a7dd3a4f2d48011">connectivity</a>, user_string,</div>
<div class="line">                                   &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a></div>
<div class="line">                  <span class="stringliteral">&quot;_file_write_connectivity: Error writing connectivity&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  snprintf (user_string, P4EST_FILE_USER_STRING_BYTES,</div>
<div class="line">            <span class="stringliteral">&quot;Quadrants of time step %04d.&quot;</span>, timestep);</div>
<div class="line">  snprintf (quad_data_user_string, P4EST_FILE_USER_STRING_BYTES,</div>
<div class="line">            <span class="stringliteral">&quot;Quadrant data of time step %04d.&quot;</span>, timestep);</div>
<div class="line"> </div>
<div class="line">  fc = p4est_file_write_p4est (fc, <a class="code" href="structp4est.html">p4est</a>,</div>
<div class="line">                               user_string, quad_data_user_string, &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_file_write_field: Error writing p4est&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  p4est_file_close (fc, &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_file_close: Error closing file&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* P4EST_ENABLE_FILE_DEPRECATED */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>         step3_timestep (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>, <span class="keywordtype">double</span> start_time,</div>
<div class="line">                                    <span class="keywordtype">double</span> end_time);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span>         step3_run (sc_MPI_Comm mpicomm);</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_restart (<span class="keyword">const</span> <span class="keywordtype">char</span> *filename, sc_MPI_Comm mpicomm, <span class="keywordtype">double</span> time_inc)</div>
<div class="line">{</div>
<div class="line"><span class="preprocessor">#ifdef P4EST_ENABLE_FILE_DEPRECATED</span></div>
<div class="line">  <span class="keywordtype">int</span>                 errcode;</div>
<div class="line">  <span class="keywordtype">char</span>                user_string[P4EST_FILE_USER_STRING_BYTES],</div>
<div class="line">    quad_string[P4EST_FILE_USER_STRING_BYTES],</div>
<div class="line">    quad_data_string[P4EST_FILE_USER_STRING_BYTES];</div>
<div class="line">  step3_ctx_t         ctx;</div>
<div class="line">  <a class="code" href="p4est__base_8h.html#af4d787f9b2520af0cfe9a10b89235749">p4est_gloidx_t</a>      global_num_quadrants;</div>
<div class="line">  p4est_file_context_t *fc;</div>
<div class="line">  <a class="code" href="structp4est.html">p4est_t</a>            *loaded_p4est;</div>
<div class="line">  <a name="_a32"></a><a class="code" href="structp4est__connectivity.html">p4est_connectivity_t</a> *conn;</div>
<div class="line">  uint32_t            check_endianness = STEP3_ENDIAN_CHECK;</div>
<div class="line">  int32_t             read_check_endianness;</div>
<div class="line">  sc_array_t          block_arr;</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* P4EST_ENABLE_FILE_DEPRECATED */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (filename == NULL) {</div>
<div class="line">    <span class="comment">/* we do not restart */</span></div>
<div class="line">    step3_run (mpicomm);</div>
<div class="line">    <span class="keywordflow">return</span>;</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#ifndef P4EST_ENABLE_FILE_DEPRECATED</span></div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    SC_ABORT_NOT_REACHED ();</div>
<div class="line">  }</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  <span class="comment">/* we use file I/O to load a checkpoint.  API will change */</span></div>
<div class="line">  fc =</div>
<div class="line">    p4est_file_open_read_ext (mpicomm, filename, user_string,</div>
<div class="line">                              &amp;global_num_quadrants, &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_file_open_read: Error opening file&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  sc_array_init_data (&amp;block_arr, &amp;read_check_endianness, <span class="keyword">sizeof</span> (uint32_t),</div>
<div class="line">                      1);</div>
<div class="line">  <span class="comment">/* read data endianness */</span></div>
<div class="line">  fc =</div>
<div class="line">    p4est_file_read_block (fc, <span class="keyword">sizeof</span> (uint32_t), &amp;block_arr,</div>
<div class="line">                           user_string, &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a></div>
<div class="line">                  <span class="stringliteral">&quot;_file_read_block: Error reading data endianness&quot;</span>);</div>
<div class="line">  P4EST_GLOBAL_PRODUCTIONF (<span class="stringliteral">&quot;Read data with user string: %s\n&quot;</span>, user_string);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Instead of handling the wrong endianness, we just abort on it.</span></div>
<div class="line"><span class="comment">   * In a more sophisticated application the data should be converted.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  SC_CHECK_ABORT (memcmp</div>
<div class="line">                  (&amp;read_check_endianness, &amp;check_endianness,</div>
<div class="line">                   <span class="keyword">sizeof</span> (uint32_t)) == 0, <span class="stringliteral">&quot;Wrong endianness&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  sc_array_init_data (&amp;block_arr, &amp;ctx, STEP3_BLOCK_SIZE, 1);</div>
<div class="line">  <span class="comment">/* read the simulation context */</span></div>
<div class="line">  fc =</div>
<div class="line">    p4est_file_read_block (fc, STEP3_BLOCK_SIZE, &amp;block_arr, user_string,</div>
<div class="line">                           &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a></div>
<div class="line">                  <span class="stringliteral">&quot;_file_read_block: Error reading simulation context&quot;</span>);</div>
<div class="line">  P4EST_GLOBAL_PRODUCTIONF (<span class="stringliteral">&quot;Read data with user string: %s\n&quot;</span>, user_string);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* read the connectivity */</span></div>
<div class="line">  fc = p4est_file_read_connectivity (fc, &amp;conn, user_string, &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a></div>
<div class="line">                  <span class="stringliteral">&quot;_file_read_connectivity: Error reading connectivity&quot;</span>);</div>
<div class="line">  P4EST_ASSERT (conn != NULL);</div>
<div class="line">  P4EST_GLOBAL_PRODUCTIONF (<span class="stringliteral">&quot;Read data with user string: %s\n&quot;</span>, user_string);</div>
<div class="line"> </div>
<div class="line">  fc = p4est_file_read_p4est (fc, conn,</div>
<div class="line">                              <span class="keyword">sizeof</span> (step3_data_t),</div>
<div class="line">                              &amp;loaded_p4est, quad_string, quad_data_string,</div>
<div class="line">                              &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (fc != NULL</div>
<div class="line">                  &amp;&amp; errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_file_read_field_ext: Error reading p4est&quot;</span>);</div>
<div class="line">  P4EST_GLOBAL_PRODUCTIONF (<span class="stringliteral">&quot;Read quadrants with user string: %s\n&quot;</span>,</div>
<div class="line">                            quad_string);</div>
<div class="line">  P4EST_GLOBAL_PRODUCTIONF (<span class="stringliteral">&quot;Read quadrant data with user string: %s\n&quot;</span>,</div>
<div class="line">                            quad_data_string);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* assign simulation context pointer */</span></div>
<div class="line">  loaded_p4est-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a> = (<span class="keywordtype">void</span> *) block_arr.array;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* close the file */</span></div>
<div class="line">  p4est_file_close (fc, &amp;errcode);</div>
<div class="line">  SC_CHECK_ABORT (errcode == P4EST_FILE_ERR_SUCCESS,</div>
<div class="line">                  <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_file_close: Error closing file&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  step3_timestep (loaded_p4est, ctx.current_time,</div>
<div class="line">                  ctx.current_time + time_inc);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* clean up */</span></div>
<div class="line">  conn = loaded_p4est-&gt;<a class="code" href="structp4est.html#a2ca31d19479e82d49a7dd3a4f2d48011">connectivity</a>;</div>
<div class="line">  <a name="a33"></a><a class="code" href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a> (loaded_p4est);</div>
<div class="line">  <a name="a34"></a><a class="code" href="p4est__connectivity_8h.html#a208e613cae5e1bd3baffb587387b672c">p4est_connectivity_destroy</a> (conn);</div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* P4EST_ENABLE_FILE_DEPRECATED */</span><span class="preprocessor"></span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_quad_divergence (<a class="code" href="structp4est__iter__volume__info.html">p4est_iter_volume_info_t</a> * info, <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a>   *q = info-&gt;<a class="code" href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">quad</a>;</div>
<div class="line">  step3_data_t       *data = (step3_data_t *) q-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line"> </div>
<div class="line">  data-&gt;dudt = 0.;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_upwind_flux (<a name="_a35"></a><a class="code" href="structp4est__iter__face__info.html">p4est_iter_face_info_t</a> * info, <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 i, j;</div>
<div class="line">  <a class="code" href="structp4est.html">p4est_t</a>            *<a class="code" href="structp4est.html">p4est</a> = info-&gt;<a name="a36"></a>p4est;</div>
<div class="line">  step3_ctx_t        *ctx = (step3_ctx_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line">  step3_data_t       *ghost_data = (step3_data_t *) user_data;</div>
<div class="line">  step3_data_t       *udata;</div>
<div class="line">  <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a>   *quad;</div>
<div class="line">  <span class="keywordtype">double</span>              vdotn = 0.;</div>
<div class="line">  <span class="keywordtype">double</span>              uavg;</div>
<div class="line">  <span class="keywordtype">double</span>              q;</div>
<div class="line">  <span class="keywordtype">double</span>              h, facearea;</div>
<div class="line">  <span class="keywordtype">int</span>                 which_face;</div>
<div class="line">  <span class="keywordtype">int</span>                 upwindside;</div>
<div class="line">  <a name="_a37"></a><a class="code" href="structp4est__iter__face__side.html">p4est_iter_face_side_t</a> *side[2];</div>
<div class="line">  sc_array_t         *sides = &amp;(info-&gt;<a name="a38"></a>sides);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* because there are no boundaries, every face has two sides */</span></div>
<div class="line">  P4EST_ASSERT (sides-&gt;elem_count == 2);</div>
<div class="line"> </div>
<div class="line">  side[0] = p4est_iter_fside_array_index_int (sides, 0);</div>
<div class="line">  side[1] = p4est_iter_fside_array_index_int (sides, 1);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* which of the quadrant&#39;s faces the interface touches */</span></div>
<div class="line">  which_face = side[0]-&gt;<a name="a39"></a><a class="code" href="structp4est__iter__face__side.html#a437fc601ac99c21e9a2d541b904042b7">face</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">switch</span> (which_face) {</div>
<div class="line">  <span class="keywordflow">case</span> 0:                      <span class="comment">/* -x side */</span></div>
<div class="line">    vdotn = -ctx-&gt;v[0];</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> 1:                      <span class="comment">/* +x side */</span></div>
<div class="line">    vdotn = ctx-&gt;v[0];</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> 2:                      <span class="comment">/* -y side */</span></div>
<div class="line">    vdotn = -ctx-&gt;v[1];</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> 3:                      <span class="comment">/* +y side */</span></div>
<div class="line">    vdotn = ctx-&gt;v[1];</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="preprocessor">#ifdef P4_TO_P8</span></div>
<div class="line">  <span class="keywordflow">case</span> 4:                      <span class="comment">/* -z side */</span></div>
<div class="line">    vdotn = -ctx-&gt;v[2];</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line">  <span class="keywordflow">case</span> 5:                      <span class="comment">/* +z side */</span></div>
<div class="line">    vdotn = ctx-&gt;v[2];</div>
<div class="line">    <span class="keywordflow">break</span>;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  }</div>
<div class="line">  upwindside = vdotn &gt;= 0. ? 0 : 1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Because we have non-conforming boundaries, one side of an interface can</span></div>
<div class="line"><span class="comment">   * either have one large (&quot;full&quot;) quadrant or 2^(d-1) small (&quot;hanging&quot;)</span></div>
<div class="line"><span class="comment">   * quadrants: we have to compute the average differently in each case.  The</span></div>
<div class="line"><span class="comment">   * info populated by p4est_iterate() gives us the context we need to</span></div>
<div class="line"><span class="comment">   * proceed. */</span></div>
<div class="line">  uavg = 0;</div>
<div class="line">  <span class="keywordflow">if</span> (side[upwindside]-&gt;is_hanging) {</div>
<div class="line">    <span class="comment">/* there are 2^(d-1) (P4EST_HALF) subfaces */</span></div>
<div class="line">    <span class="keywordflow">for</span> (j = 0; j &lt; <a name="a40"></a><a class="code" href="p4est__connectivity_8h.html#a23079dfa254ae5df731633a54a8382f0">P4EST_HALF</a>; j++) {</div>
<div class="line">      <span class="keywordflow">if</span> (side[upwindside]-&gt;is.hanging.is_ghost[j]) {</div>
<div class="line">        <span class="comment">/* *INDENT-OFF* */</span></div>
<div class="line">        udata =</div>
<div class="line">          (step3_data_t *) &amp;ghost_data[side[upwindside]-&gt;is.hanging.quadid[j]];</div>
<div class="line">        <span class="comment">/* *INDENT-ON* */</span></div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> {</div>
<div class="line">        udata =</div>
<div class="line">          (step3_data_t *) side[upwindside]-&gt;is.hanging.quad[j]-&gt;p.user_data;</div>
<div class="line">      }</div>
<div class="line">      uavg += udata-&gt;u;</div>
<div class="line">    }</div>
<div class="line">    uavg /= <a class="code" href="p4est__connectivity_8h.html#a23079dfa254ae5df731633a54a8382f0">P4EST_HALF</a>;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="keywordflow">if</span> (side[upwindside]-&gt;is.full.is_ghost) {</div>
<div class="line">      udata = (step3_data_t *) &amp; ghost_data[side[upwindside]-&gt;is.full.quadid];</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      udata = (step3_data_t *) side[upwindside]-&gt;is.full.quad-&gt;p.user_data;</div>
<div class="line">    }</div>
<div class="line">    uavg = udata-&gt;u;</div>
<div class="line">  }</div>
<div class="line">  <span class="comment">/* flux from side 0 to side 1 */</span></div>
<div class="line">  q = vdotn * uavg;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {</div>
<div class="line">    <span class="keywordflow">if</span> (side[i]-&gt;is_hanging) {</div>
<div class="line">      <span class="comment">/* there are 2^(d-1) (P4EST_HALF) subfaces */</span></div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="p4est__connectivity_8h.html#a23079dfa254ae5df731633a54a8382f0">P4EST_HALF</a>; j++) {</div>
<div class="line">        quad = side[i]-&gt;<a name="a41"></a>is.<a name="a42"></a><a class="code" href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#aab4d82c9073b31abd091d5383a69b63c">hanging</a>.<a name="a43"></a><a class="code" href="structp4est__iter__face__side__hanging.html#a16fc5a7f97d0b39657797658d5afab3e">quad</a>[j];</div>
<div class="line">        h =</div>
<div class="line">          (double) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (quad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line"><span class="preprocessor">#ifndef P4_TO_P8</span></div>
<div class="line">        facearea = h;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">        facearea = h * h;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">        <span class="keywordflow">if</span> (!side[i]-&gt;is.hanging.is_ghost[j]) {</div>
<div class="line">          udata = (step3_data_t *) quad-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">          if (i == upwindside) {</div>
<div class="line">            udata-&gt;dudt += vdotn * udata-&gt;u * facearea * (i ? 1. : -1.);</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">else</span> {</div>
<div class="line">            udata-&gt;dudt += q * facearea * (i ? 1. : -1.);</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      quad = side[i]-&gt;is.<a name="a44"></a><a class="code" href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#abb2075c4a1ed0a326779d6c1462fefe2">full</a>.<a name="a45"></a><a class="code" href="structp4est__iter__face__side__full.html#a89f38f0bf009c7448bdf7d97884ce2d3">quad</a>;</div>
<div class="line">      h = (double) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (quad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line"><span class="preprocessor">#ifndef P4_TO_P8</span></div>
<div class="line">      facearea = h;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">      facearea = h * h;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">      <span class="keywordflow">if</span> (!side[i]-&gt;is.full.is_ghost) {</div>
<div class="line">        udata = (step3_data_t *) quad-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">        udata-&gt;dudt += q * facearea * (i ? 1. : -1.);</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_timestep_update (<a class="code" href="structp4est__iter__volume__info.html">p4est_iter_volume_info_t</a> * info, <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a>   *q = info-&gt;<a class="code" href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">quad</a>;</div>
<div class="line">  step3_data_t       *data = (step3_data_t *) q-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">  <span class="keywordtype">double</span>              dt = *((<span class="keywordtype">double</span> *) user_data);</div>
<div class="line">  <span class="keywordtype">double</span>              vol;</div>
<div class="line">  <span class="keywordtype">double</span>              h =</div>
<div class="line">    (double) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (q-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef P4_TO_P8</span></div>
<div class="line">  vol = h * h * h;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  vol = h * h;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  data-&gt;u += dt * data-&gt;dudt / vol;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_reset_derivatives (<a class="code" href="structp4est__iter__volume__info.html">p4est_iter_volume_info_t</a> * info, <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a>   *q = info-&gt;<a class="code" href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">quad</a>;</div>
<div class="line">  step3_data_t       *data = (step3_data_t *) q-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                 j;</div>
<div class="line"> </div>
<div class="line">  for (j = 0; j &lt; <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>; j++) {</div>
<div class="line">    data-&gt;du[j] = step3_invalid;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_minmod_estimate (<a class="code" href="structp4est__iter__face__info.html">p4est_iter_face_info_t</a> * info, <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 i, j;</div>
<div class="line">  <a class="code" href="structp4est__iter__face__side.html">p4est_iter_face_side_t</a> *side[2];</div>
<div class="line">  sc_array_t         *sides = &amp;(info-&gt;sides);</div>
<div class="line">  step3_data_t       *ghost_data = (step3_data_t *) user_data;</div>
<div class="line">  step3_data_t       *udata;</div>
<div class="line">  <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a>   *quad;</div>
<div class="line">  <span class="keywordtype">double</span>              uavg[2];</div>
<div class="line">  <span class="keywordtype">double</span>              h[2];</div>
<div class="line">  <span class="keywordtype">double</span>              du_est, du_old;</div>
<div class="line">  <span class="keywordtype">int</span>                 which_dir;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* because there are no boundaries, every face has two sides */</span></div>
<div class="line">  P4EST_ASSERT (sides-&gt;elem_count == 2);</div>
<div class="line"> </div>
<div class="line">  side[0] = p4est_iter_fside_array_index_int (sides, 0);</div>
<div class="line">  side[1] = p4est_iter_fside_array_index_int (sides, 1);</div>
<div class="line"> </div>
<div class="line">  which_dir = side[0]-&gt;<a class="code" href="structp4est__iter__face__side.html#a437fc601ac99c21e9a2d541b904042b7">face</a> / 2;        <span class="comment">/* 0 == x, 1 == y, 2 == z */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {</div>
<div class="line">    uavg[i] = 0;</div>
<div class="line">    <span class="keywordflow">if</span> (side[i]-&gt;is_hanging) {</div>
<div class="line">      <span class="comment">/* there are 2^(d-1) (P4EST_HALF) subfaces */</span></div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="p4est__connectivity_8h.html#a23079dfa254ae5df731633a54a8382f0">P4EST_HALF</a>; j++) {</div>
<div class="line">        quad = side[i]-&gt;is.<a class="code" href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#aab4d82c9073b31abd091d5383a69b63c">hanging</a>.<a class="code" href="structp4est__iter__face__side__hanging.html#a16fc5a7f97d0b39657797658d5afab3e">quad</a>[j];</div>
<div class="line">        h[i] =</div>
<div class="line">          (double) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (quad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line">        <span class="keywordflow">if</span> (side[i]-&gt;is.hanging.is_ghost[j]) {</div>
<div class="line">          udata = &amp;ghost_data[side[i]-&gt;is.<a class="code" href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#aab4d82c9073b31abd091d5383a69b63c">hanging</a>.<a name="a46"></a><a class="code" href="structp4est__iter__face__side__hanging.html#adcfe28552cc20c79095e062a7d3129ca">quadid</a>[j]];</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">          udata = (step3_data_t *) side[i]-&gt;is.hanging.quad[j]-&gt;p.user_data;</div>
<div class="line">        }</div>
<div class="line">        uavg[i] += udata-&gt;u;</div>
<div class="line">      }</div>
<div class="line">      uavg[i] /= <a class="code" href="p4est__connectivity_8h.html#a23079dfa254ae5df731633a54a8382f0">P4EST_HALF</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      quad = side[i]-&gt;is.<a class="code" href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#abb2075c4a1ed0a326779d6c1462fefe2">full</a>.<a class="code" href="structp4est__iter__face__side__full.html#a89f38f0bf009c7448bdf7d97884ce2d3">quad</a>;</div>
<div class="line">      h[i] =</div>
<div class="line">        (double) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (quad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) / (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line">      <span class="keywordflow">if</span> (side[i]-&gt;is.full.is_ghost) {</div>
<div class="line">        udata = &amp;ghost_data[side[i]-&gt;is.<a class="code" href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#abb2075c4a1ed0a326779d6c1462fefe2">full</a>.<a name="a47"></a><a class="code" href="structp4est__iter__face__side__full.html#aad5d25e815207300384b82840f126d44">quadid</a>];</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> {</div>
<div class="line">        udata = (step3_data_t *) side[i]-&gt;is.full.quad-&gt;p.user_data;</div>
<div class="line">      }</div>
<div class="line">      uavg[i] = udata-&gt;u;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  du_est = (uavg[1] - uavg[0]) / ((h[0] + h[1]) / 2.);</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {</div>
<div class="line">    <span class="keywordflow">if</span> (side[i]-&gt;is_hanging) {</div>
<div class="line">      <span class="comment">/* there are 2^(d-1) (P4EST_HALF) subfaces */</span></div>
<div class="line">      <span class="keywordflow">for</span> (j = 0; j &lt; <a class="code" href="p4est__connectivity_8h.html#a23079dfa254ae5df731633a54a8382f0">P4EST_HALF</a>; j++) {</div>
<div class="line">        quad = side[i]-&gt;is.<a class="code" href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#aab4d82c9073b31abd091d5383a69b63c">hanging</a>.<a class="code" href="structp4est__iter__face__side__hanging.html#a16fc5a7f97d0b39657797658d5afab3e">quad</a>[j];</div>
<div class="line">        <span class="keywordflow">if</span> (!side[i]-&gt;is.hanging.is_ghost[j]) {</div>
<div class="line">          udata = (step3_data_t *) quad-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">          du_old = udata-&gt;du[which_dir];</div>
<div class="line">          if (du_old == du_old) {</div>
<div class="line">            <span class="comment">/* there has already been an update */</span></div>
<div class="line">            <span class="keywordflow">if</span> (du_est * du_old &gt;= 0.) {</div>
<div class="line">              <span class="keywordflow">if</span> (fabs (du_est) &lt; fabs (du_old)) {</div>
<div class="line">                udata-&gt;du[which_dir] = du_est;</div>
<div class="line">              }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">else</span> {</div>
<div class="line">              udata-&gt;du[which_dir] = 0.;</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">else</span> {</div>
<div class="line">            udata-&gt;du[which_dir] = du_est;</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      quad = side[i]-&gt;is.<a class="code" href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#abb2075c4a1ed0a326779d6c1462fefe2">full</a>.<a class="code" href="structp4est__iter__face__side__full.html#a89f38f0bf009c7448bdf7d97884ce2d3">quad</a>;</div>
<div class="line">      <span class="keywordflow">if</span> (!side[i]-&gt;is.full.is_ghost) {</div>
<div class="line">        udata = (step3_data_t *) quad-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">        du_old = udata-&gt;du[which_dir];</div>
<div class="line">        if (du_old == du_old) {</div>
<div class="line">          <span class="comment">/* there has already been an update */</span></div>
<div class="line">          <span class="keywordflow">if</span> (du_est * du_old &gt;= 0.) {</div>
<div class="line">            <span class="keywordflow">if</span> (fabs (du_est) &lt; fabs (du_old)) {</div>
<div class="line">              udata-&gt;du[which_dir] = du_est;</div>
<div class="line">            }</div>
<div class="line">          }</div>
<div class="line">          <span class="keywordflow">else</span> {</div>
<div class="line">            udata-&gt;du[which_dir] = 0.;</div>
<div class="line">          }</div>
<div class="line">        }</div>
<div class="line">        <span class="keywordflow">else</span> {</div>
<div class="line">          udata-&gt;du[which_dir] = du_est;</div>
<div class="line">        }</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_compute_max (<a class="code" href="structp4est__iter__volume__info.html">p4est_iter_volume_info_t</a> * info, <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a>   *q = info-&gt;<a class="code" href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">quad</a>;</div>
<div class="line">  step3_data_t       *data = (step3_data_t *) q-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">  <span class="keywordtype">double</span>              umax = *((<span class="keywordtype">double</span> *) user_data);</div>
<div class="line"> </div>
<div class="line">  umax = SC_MAX (data-&gt;u, umax);</div>
<div class="line"> </div>
<div class="line">  *((<span class="keywordtype">double</span> *) user_data) = umax;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span></div>
<div class="line">step3_get_timestep (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>)</div>
<div class="line">{</div>
<div class="line">  step3_ctx_t        *ctx = (step3_ctx_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line">  <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a>      t, flt, llt;</div>
<div class="line">  <a class="code" href="structp4est__tree.html">p4est_tree_t</a>       *tree;</div>
<div class="line">  <span class="keywordtype">int</span>                 max_level, global_max_level;</div>
<div class="line">  <span class="keywordtype">int</span>                 mpiret, i;</div>
<div class="line">  <span class="keywordtype">double</span>              min_h, vnorm;</div>
<div class="line">  <span class="keywordtype">double</span>              dt;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* compute the timestep by finding the smallest quadrant */</span></div>
<div class="line">  flt = <a class="code" href="structp4est.html">p4est</a>-&gt;<a name="a48"></a><a class="code" href="structp4est.html#a124d4dc0b8cd3b07351de80f19351beb">first_local_tree</a>;</div>
<div class="line">  llt = <a class="code" href="structp4est.html">p4est</a>-&gt;<a name="a49"></a><a class="code" href="structp4est.html#abd072c07f3197827fe22c16379de6ab8">last_local_tree</a>;</div>
<div class="line"> </div>
<div class="line">  max_level = 0;</div>
<div class="line">  for (t = flt; t &lt;= llt; t++) {</div>
<div class="line">    tree = p4est_tree_array_index (<a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a6158d35a403f1dbec23833746c5b4a8b">trees</a>, t);</div>
<div class="line">    max_level = SC_MAX (max_level, tree-&gt;<a name="a50"></a><a class="code" href="structp4est__tree.html#a93ee1718ce000fa3468848fb1673a689">maxlevel</a>);</div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line">  mpiret =</div>
<div class="line">    sc_MPI_Allreduce (&amp;max_level, &amp;global_max_level, 1, sc_MPI_INT,</div>
<div class="line">                      sc_MPI_MAX, <a class="code" href="structp4est.html">p4est</a>-&gt;<a name="a51"></a><a class="code" href="structp4est.html#a88446986bafb8d46456976515b22c856">mpicomm</a>);</div>
<div class="line">  SC_CHECK_MPI (mpiret);</div>
<div class="line"> </div>
<div class="line">  min_h =</div>
<div class="line">    (double) <a class="code" href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a> (global_max_level) / (double) <a class="code" href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a>;</div>
<div class="line"> </div>
<div class="line">  vnorm = 0;</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>; i++) {</div>
<div class="line">    vnorm += ctx-&gt;v[i] * ctx-&gt;v[i];</div>
<div class="line">  }</div>
<div class="line">  vnorm = sqrt (vnorm);</div>
<div class="line"> </div>
<div class="line">  dt = min_h / 2. / vnorm;</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">return</span> dt;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_timestep (<a class="code" href="structp4est.html">p4est_t</a> * <a class="code" href="structp4est.html">p4est</a>, <span class="keywordtype">double</span> start_time, <span class="keywordtype">double</span> end_time)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">double</span>              t = start_time;</div>
<div class="line">  <span class="keywordtype">double</span>              dt = 0.;</div>
<div class="line">  <span class="keywordtype">int</span>                 i;</div>
<div class="line">  step3_data_t       *ghost_data;</div>
<div class="line">  step3_ctx_t        *ctx = (step3_ctx_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                 refine_period = ctx-&gt;refine_period;</div>
<div class="line">  <span class="keywordtype">int</span>                 repartition_period = ctx-&gt;repartition_period;</div>
<div class="line">  <span class="keywordtype">int</span>                 write_period = ctx-&gt;write_period;</div>
<div class="line">  <span class="keywordtype">int</span>                 recursive = 0;</div>
<div class="line">  <span class="keywordtype">int</span>                 allowed_level = <a name="a52"></a><a class="code" href="p4est_8h.html#a398bac71234696389c90d0f986bb31aa">P4EST_QMAXLEVEL</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                 allowcoarsening = 1;</div>
<div class="line">  <span class="keywordtype">int</span>                 callbackorphans = 0;</div>
<div class="line">  <span class="keywordtype">int</span>                 mpiret;</div>
<div class="line">  <span class="keywordtype">double</span>              orig_max_err = ctx-&gt;max_err;</div>
<div class="line">  <span class="keywordtype">double</span>              umax, global_umax;</div>
<div class="line">  <a name="_a53"></a><a class="code" href="structp4est__ghost.html">p4est_ghost_t</a>      *ghost;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* create the ghost quadrants */</span></div>
<div class="line">  ghost = <a name="a54"></a><a class="code" href="p4est__ghost_8h.html#a34a0bfb7169437f6fc2382a67c47e89d">p4est_ghost_new</a> (<a class="code" href="structp4est.html">p4est</a>, <a name="a55"></a><a class="code" href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552caa5bf35c11d90c02cb481e9edadb51bda7">P4EST_CONNECT_FULL</a>);</div>
<div class="line">  <span class="comment">/* create space for storing the ghost data */</span></div>
<div class="line">  ghost_data = <a name="a56"></a><a class="code" href="p4est__base_8h.html#a1fef909873d570158d6ac7b43c7d94f1">P4EST_ALLOC</a> (step3_data_t, ghost-&gt;ghosts.elem_count);</div>
<div class="line">  <span class="comment">/* synchronize the ghost data */</span></div>
<div class="line">  <a name="a57"></a><a class="code" href="p4est__ghost_8h.html#a58908a7bf0810077c99a6ddccc642fcd">p4est_ghost_exchange_data</a> (<a class="code" href="structp4est.html">p4est</a>, ghost, ghost_data);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* initialize du/dx estimates */</span></div>
<div class="line">  <a class="code" href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a> (<a class="code" href="structp4est.html">p4est</a>, ghost, (<span class="keywordtype">void</span> *) ghost_data,     <span class="comment">/* pass in ghost data that we just exchanged */</span></div>
<div class="line">                 step3_reset_derivatives,       <span class="comment">/* blank the previously calculated derivatives */</span></div>
<div class="line">                 step3_minmod_estimate, <span class="comment">/* compute the minmod estimate of each cell&#39;s derivative */</span></div>
<div class="line">#ifdef P4_TO_P8</div>
<div class="line">                 NULL,          <span class="comment">/* there is no callback for the edges between quadrants */</span></div>
<div class="line">#endif</div>
<div class="line">                 NULL);         <span class="comment">/* there is no callback for the corners between quadrants */</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">for</span> (t = start_time, i = ctx-&gt;time_step; t &lt; end_time; t += dt, i++) {</div>
<div class="line">    P4EST_GLOBAL_PRODUCTIONF (<span class="stringliteral">&quot;time %f\n&quot;</span>, t);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* refine */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!(i % refine_period)) {</div>
<div class="line">      <span class="keywordflow">if</span> (i) {</div>
<div class="line">        <span class="comment">/* compute umax */</span></div>
<div class="line">        umax = 0.;</div>
<div class="line">        <span class="comment">/* initialize derivative estimates */</span></div>
<div class="line">        <a class="code" href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a> (<a class="code" href="structp4est.html">p4est</a>, NULL, (<span class="keywordtype">void</span> *) &amp;umax,     <span class="comment">/* pass in ghost data that we just exchanged */</span></div>
<div class="line">                       step3_compute_max,       <span class="comment">/* blank the previously calculated derivatives */</span></div>
<div class="line">                       NULL,    <span class="comment">/* there is no callback for the faces between quadrants */</span></div>
<div class="line">#ifdef P4_TO_P8</div>
<div class="line">                       NULL,    <span class="comment">/* there is no callback for the edges between quadrants */</span></div>
<div class="line">#endif</div>
<div class="line">                       NULL);   <span class="comment">/* there is no callback for the corners between quadrants */</span></div>
<div class="line"> </div>
<div class="line">        mpiret =</div>
<div class="line">          sc_MPI_Allreduce (&amp;umax, &amp;global_umax, 1, sc_MPI_DOUBLE, sc_MPI_MAX,</div>
<div class="line">                            <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a88446986bafb8d46456976515b22c856">mpicomm</a>);</div>
<div class="line">        SC_CHECK_MPI (mpiret);</div>
<div class="line">        ctx-&gt;max_err = orig_max_err * global_umax;</div>
<div class="line">        P4EST_GLOBAL_PRODUCTIONF (<span class="stringliteral">&quot;u_max %f\n&quot;</span>, global_umax);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">/* adapt */</span></div>
<div class="line">        <a name="a58"></a><a class="code" href="p4est__extended_8h.html#aad32df9df3630b6bac05e7366a5f1e46">p4est_refine_ext</a> (<a class="code" href="structp4est.html">p4est</a>, recursive, allowed_level,</div>
<div class="line">                          step3_refine_err_estimate, NULL,</div>
<div class="line">                          step3_replace_quads);</div>
<div class="line">        <a name="a59"></a><a class="code" href="p4est__extended_8h.html#a06630b99f70cb85c73452640e8b4d54e">p4est_coarsen_ext</a> (<a class="code" href="structp4est.html">p4est</a>, recursive, callbackorphans,</div>
<div class="line">                           step3_coarsen_err_estimate, NULL,</div>
<div class="line">                           step3_replace_quads);</div>
<div class="line">        <a name="a60"></a><a class="code" href="p4est__extended_8h.html#a666a197be8d6d83c08cc14bfdc8565ed">p4est_balance_ext</a> (<a class="code" href="structp4est.html">p4est</a>, <a name="a61"></a><a class="code" href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552caa33499fc87edef5b1226ade261dd0d6e6">P4EST_CONNECT_FACE</a>, NULL,</div>
<div class="line">                           step3_replace_quads);</div>
<div class="line"> </div>
<div class="line">        <a name="a62"></a><a class="code" href="p4est__ghost_8h.html#a4b4ae4fa996d0b8705d6267953c3e757">p4est_ghost_destroy</a> (ghost);</div>
<div class="line">        <a name="a63"></a><a class="code" href="p4est__base_8h.html#a0b2d45f13b66edfed0ccfde75808c745">P4EST_FREE</a> (ghost_data);</div>
<div class="line">        ghost = NULL;</div>
<div class="line">        ghost_data = NULL;</div>
<div class="line">      }</div>
<div class="line">      dt = step3_get_timestep (<a class="code" href="structp4est.html">p4est</a>);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* repartition */</span></div>
<div class="line">    <span class="keywordflow">if</span> (i &amp;&amp; !(i % repartition_period)) {</div>
<div class="line">      <a name="a64"></a><a class="code" href="p4est_8h.html#a54c1f4e6bc35c181952371a8046523aa">p4est_partition</a> (<a class="code" href="structp4est.html">p4est</a>, allowcoarsening, NULL);</div>
<div class="line"> </div>
<div class="line">      <span class="keywordflow">if</span> (ghost) {</div>
<div class="line">        <a class="code" href="p4est__ghost_8h.html#a4b4ae4fa996d0b8705d6267953c3e757">p4est_ghost_destroy</a> (ghost);</div>
<div class="line">        <a class="code" href="p4est__base_8h.html#a0b2d45f13b66edfed0ccfde75808c745">P4EST_FREE</a> (ghost_data);</div>
<div class="line">        ghost = NULL;</div>
<div class="line">        ghost_data = NULL;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* write out solution */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!(i % write_period)) {</div>
<div class="line">      step3_write_solution (<a class="code" href="structp4est.html">p4est</a>, i);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* synchronize the ghost data */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!ghost) {</div>
<div class="line">      ghost = <a class="code" href="p4est__ghost_8h.html#a34a0bfb7169437f6fc2382a67c47e89d">p4est_ghost_new</a> (<a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552caa5bf35c11d90c02cb481e9edadb51bda7">P4EST_CONNECT_FULL</a>);</div>
<div class="line">      ghost_data = <a class="code" href="p4est__base_8h.html#a1fef909873d570158d6ac7b43c7d94f1">P4EST_ALLOC</a> (step3_data_t, ghost-&gt;ghosts.elem_count);</div>
<div class="line">      <a class="code" href="p4est__ghost_8h.html#a58908a7bf0810077c99a6ddccc642fcd">p4est_ghost_exchange_data</a> (<a class="code" href="structp4est.html">p4est</a>, ghost, ghost_data);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* compute du/dt */</span></div>
<div class="line">    <span class="comment">/* *INDENT-OFF* */</span></div>
<div class="line">    <a class="code" href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a> (<a class="code" href="structp4est.html">p4est</a>,                 <span class="comment">/* the forest */</span></div>
<div class="line">                   ghost,                 <span class="comment">/* the ghost layer */</span></div>
<div class="line">                   (<span class="keywordtype">void</span> *) ghost_data,   <span class="comment">/* the synchronized ghost data */</span></div>
<div class="line">                   step3_quad_divergence, <span class="comment">/* callback to compute each quad&#39;s</span></div>
<div class="line"><span class="comment">                                             interior contribution to du/dt */</span></div>
<div class="line">                   step3_upwind_flux,     <span class="comment">/* callback to compute each quads&#39;</span></div>
<div class="line"><span class="comment">                                             faces&#39; contributions to du/du */</span></div>
<div class="line">#ifdef P4_TO_P8</div>
<div class="line">                   NULL,                  <span class="comment">/* there is no callback for the</span></div>
<div class="line"><span class="comment">                                             edges between quadrants */</span></div>
<div class="line">#endif</div>
<div class="line">                   NULL);                 <span class="comment">/* there is no callback for the</span></div>
<div class="line"><span class="comment">                                             corners between quadrants */</span></div>
<div class="line">    <span class="comment">/* *INDENT-ON* */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* update u */</span></div>
<div class="line">    <a class="code" href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a> (<a class="code" href="structp4est.html">p4est</a>, NULL, <span class="comment">/* ghosts are not needed for this loop */</span></div>
<div class="line">                   (<span class="keywordtype">void</span> *) &amp;dt,        <span class="comment">/* pass in dt */</span></div>
<div class="line">                   step3_timestep_update,       <span class="comment">/* update each cell */</span></div>
<div class="line">                   NULL,        <span class="comment">/* there is no callback for the faces between quadrants */</span></div>
<div class="line">#ifdef P4_TO_P8</div>
<div class="line">                   NULL,        <span class="comment">/* there is no callback for the edges between quadrants */</span></div>
<div class="line">#endif</div>
<div class="line">                   NULL);       <span class="comment">/* there is no callback for the corners between quadrants */</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* synchronize the ghost data */</span></div>
<div class="line">    <a class="code" href="p4est__ghost_8h.html#a58908a7bf0810077c99a6ddccc642fcd">p4est_ghost_exchange_data</a> (<a class="code" href="structp4est.html">p4est</a>, ghost, ghost_data);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* update du/dx estimate */</span></div>
<div class="line">    <a class="code" href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a> (<a class="code" href="structp4est.html">p4est</a>, ghost, (<span class="keywordtype">void</span> *) ghost_data,   <span class="comment">/* pass in ghost data that we just exchanged */</span></div>
<div class="line">                   step3_reset_derivatives,     <span class="comment">/* blank the previously calculated derivatives */</span></div>
<div class="line">                   step3_minmod_estimate,       <span class="comment">/* compute the minmod estimate of each cell&#39;s derivative */</span></div>
<div class="line">#ifdef P4_TO_P8</div>
<div class="line">                   NULL,        <span class="comment">/* there is no callback for the edges between quadrants */</span></div>
<div class="line">#endif</div>
<div class="line">                   NULL);       <span class="comment">/* there is no callback for the corners between quadrants */</span></div>
<div class="line"> </div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  ctx-&gt;time_step = i - 1;</div>
<div class="line">  ctx-&gt;current_time = t - dt;</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#ifdef P4EST_ENABLE_FILE_DEPRECATED</span></div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (step3_checkpoint) {</div>
<div class="line">    <span class="comment">/* write checkpoint file */</span></div>
<div class="line">    step3_write_checkpoint (<a class="code" href="structp4est.html">p4est</a>, i - 1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#endif </span><span class="comment">/* P4EST_ENABLE_FILE_DEPRECATED */</span><span class="preprocessor"></span></div>
<div class="line"> </div>
<div class="line">  <a class="code" href="p4est__base_8h.html#a0b2d45f13b66edfed0ccfde75808c745">P4EST_FREE</a> (ghost_data);</div>
<div class="line">  <a class="code" href="p4est__ghost_8h.html#a4b4ae4fa996d0b8705d6267953c3e757">p4est_ghost_destroy</a> (ghost);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">step3_run (sc_MPI_Comm mpicomm)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="structp4est__connectivity.html">p4est_connectivity_t</a> *conn;</div>
<div class="line">  <a class="code" href="structp4est.html">p4est_t</a>            *<a class="code" href="structp4est.html">p4est</a>;</div>
<div class="line">  <span class="keywordtype">int</span>                 recursive, partforcoarsen;</div>
<div class="line">  step3_ctx_t         ctx;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Avoid write of uninitialized bytes (valgrind warning)</span></div>
<div class="line"><span class="comment">   * due to compiler padding.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  memset (&amp;ctx, -1, <span class="keyword">sizeof</span> (ctx));</div>
<div class="line"> </div>
<div class="line">  ctx.bump_width = 0.1;</div>
<div class="line">  ctx.max_err = 2.e-2;</div>
<div class="line">  ctx.center[0] = 0.5;</div>
<div class="line">  ctx.center[1] = 0.5;</div>
<div class="line"><span class="preprocessor">#ifdef P4_TO_P8</span></div>
<div class="line">  ctx.center[2] = 0.5;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor">#ifndef P4_TO_P8</span></div>
<div class="line">  <span class="comment">/* randomly chosen advection direction */</span></div>
<div class="line">  ctx.v[0] = -0.445868402501118;</div>
<div class="line">  ctx.v[1] = -0.895098523991131;</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  ctx.v[0] = 0.485191768970225;</div>
<div class="line">  ctx.v[1] = -0.427996381877778;</div>
<div class="line">  ctx.v[2] = 0.762501176669961;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  ctx.refine_period = 2;</div>
<div class="line">  ctx.repartition_period = 4;</div>
<div class="line">  ctx.write_period = 8;</div>
<div class="line">  ctx.time_step = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Create a forest that consists of just one periodic quadtree/octree. */</span></div>
<div class="line"><span class="preprocessor">#ifndef P4_TO_P8</span></div>
<div class="line">  conn = <a name="a65"></a><a class="code" href="p4est__connectivity_8h.html#ae65fe72b77b6f6c6825fc33efc101dab">p4est_connectivity_new_periodic</a> ();</div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line">  conn = <a name="a66"></a><a class="code" href="p8est__connectivity_8h.html#a1374c4c2fc06e436e047d32c28b87288">p8est_connectivity_new_periodic</a> ();</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* *INDENT-OFF* */</span></div>
<div class="line">  <a class="code" href="structp4est.html">p4est</a> = <a name="a67"></a><a class="code" href="p4est__extended_8h.html#ac11cf572e8ac72c4beb78465f98b63f3">p4est_new_ext</a> (mpicomm, <span class="comment">/* communicator */</span></div>
<div class="line">                         conn,    <span class="comment">/* connectivity */</span></div>
<div class="line">                         0,       <span class="comment">/* minimum quadrants per MPI process */</span></div>
<div class="line">                         4,       <span class="comment">/* minimum level of refinement */</span></div>
<div class="line">                         1,       <span class="comment">/* fill uniform */</span></div>
<div class="line">                         <span class="keyword">sizeof</span> (step3_data_t),         <span class="comment">/* data size */</span></div>
<div class="line">                         step3_init_initial_condition,  <span class="comment">/* initializes data */</span></div>
<div class="line">                         (<span class="keywordtype">void</span> *) (&amp;ctx));              <span class="comment">/* context */</span></div>
<div class="line">  <span class="comment">/* *INDENT-ON* */</span></div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* refine and coarsen based on an interpolation error estimate */</span></div>
<div class="line">  recursive = 1;</div>
<div class="line">  <a name="a68"></a><a class="code" href="p4est_8h.html#a1a31375edfa42b5609e7656233c32cca">p4est_refine</a> (<a class="code" href="structp4est.html">p4est</a>, recursive, step3_refine_err_estimate,</div>
<div class="line">                step3_init_initial_condition);</div>
<div class="line">  <a name="a69"></a><a class="code" href="p4est_8h.html#ad250f4765d9778ec3940e9fabea7c853">p4est_coarsen</a> (<a class="code" href="structp4est.html">p4est</a>, recursive, step3_coarsen_initial_condition,</div>
<div class="line">                 step3_init_initial_condition);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Partition: The quadrants are redistributed for equal element count.  The</span></div>
<div class="line"><span class="comment">   * partition can optionally be modified such that a family of octants, which</span></div>
<div class="line"><span class="comment">   * are possibly ready for coarsening, are never split between processors. */</span></div>
<div class="line">  partforcoarsen = 1;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* If we call the 2:1 balance we ensure that neighbors do not differ in size</span></div>
<div class="line"><span class="comment">   * by more than a factor of 2.  This can optionally include diagonal</span></div>
<div class="line"><span class="comment">   * neighbors across edges or corners as well; see p4est.h. */</span></div>
<div class="line">  <a name="a70"></a><a class="code" href="p4est_8h.html#a6b603736cf5007b14755197a9c179a85">p4est_balance</a> (<a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552caa33499fc87edef5b1226ade261dd0d6e6">P4EST_CONNECT_FACE</a>, step3_init_initial_condition);</div>
<div class="line">  <a class="code" href="p4est_8h.html#a54c1f4e6bc35c181952371a8046523aa">p4est_partition</a> (<a class="code" href="structp4est.html">p4est</a>, partforcoarsen, NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* time step */</span></div>
<div class="line">  step3_timestep (<a class="code" href="structp4est.html">p4est</a>, 0., 0.1);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Destroy the p4est and the connectivity structure. */</span></div>
<div class="line">  <a class="code" href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a> (<a class="code" href="structp4est.html">p4est</a>);</div>
<div class="line">  <a class="code" href="p4est__connectivity_8h.html#a208e613cae5e1bd3baffb587387b672c">p4est_connectivity_destroy</a> (conn);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">main (<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span> **argv)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 mpiret, retval;</div>
<div class="line">  <span class="keywordtype">int</span>                 help, usage_error;</div>
<div class="line">  sc_MPI_Comm         mpicomm;</div>
<div class="line">  sc_options_t       *opt;</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>         *filename;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Initialize MPI; see sc_mpi.h.</span></div>
<div class="line"><span class="comment">   * If configure --enable-mpi is given these are true MPI calls.</span></div>
<div class="line"><span class="comment">   * Else these are dummy functions that simulate a single-processor run. */</span></div>
<div class="line">  mpiret = sc_MPI_Init (&amp;argc, &amp;argv);</div>
<div class="line">  SC_CHECK_MPI (mpiret);</div>
<div class="line">  mpicomm = sc_MPI_COMM_WORLD;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* These functions are optional.  If called they store the MPI rank as a</span></div>
<div class="line"><span class="comment">   * static variable so subsequent global p4est log messages are only issued</span></div>
<div class="line"><span class="comment">   * from processor zero.  Here we turn off most of the logging; see sc.h. */</span></div>
<div class="line">  sc_init (mpicomm, 1, 1, NULL, SC_LP_ESSENTIAL);</div>
<div class="line">  <a name="a71"></a><a class="code" href="p4est__base_8h.html#aab4b16aa58790d309e0cf46ed665c6b9">p4est_init</a> (NULL, SC_LP_PRODUCTION);</div>
<div class="line">  P4EST_GLOBAL_PRODUCTIONF</div>
<div class="line">    (<span class="stringliteral">&quot;This is the p4est %dD demo example/steps/%s_step3\n&quot;</span>,</div>
<div class="line">     <a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>, <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Read command line options */</span></div>
<div class="line">  filename = NULL;</div>
<div class="line">  opt = sc_options_new (argv[0]);</div>
<div class="line">  sc_options_add_bool (opt, <span class="charliteral">&#39;H&#39;</span>, <span class="stringliteral">&quot;help&quot;</span>, &amp;help, 0,</div>
<div class="line">                       <span class="stringliteral">&quot;Print the help string and end the program&quot;</span>);</div>
<div class="line"><span class="preprocessor">#ifdef P4EST_ENABLE_FILE_DEPRECATED</span></div>
<div class="line">  sc_options_add_bool (opt, <span class="charliteral">&#39;C&#39;</span>, <span class="stringliteral">&quot;write-checkpoint&quot;</span>, &amp;step3_checkpoint, 0,</div>
<div class="line">                       <span class="stringliteral">&quot;Write checkpoint files to disk&quot;</span>);</div>
<div class="line">  sc_options_add_string (opt, <span class="charliteral">&#39;L&#39;</span>, <span class="stringliteral">&quot;load-checkpoint&quot;</span>, &amp;filename,</div>
<div class="line">                         NULL, <span class="stringliteral">&quot;Load and start from a checkpoint file&quot;</span>);</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  retval = sc_options_parse (<a name="a72"></a><a class="code" href="p4est__base_8h.html#a8deb5ddec79dfbbadf8bbbf065ec5a9c">p4est_package_id</a>, SC_LP_ERROR, opt, argc, argv);</div>
<div class="line">  usage_error = (retval == -1 || retval &lt; argc);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Action of the main program: error out or run demonstration */</span></div>
<div class="line">  <span class="keywordflow">if</span> (usage_error || help) {</div>
<div class="line">    sc_options_print_usage (<a class="code" href="p4est__base_8h.html#a8deb5ddec79dfbbadf8bbbf065ec5a9c">p4est_package_id</a>, SC_LP_PRODUCTION, opt, NULL);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    sc_options_print_summary (<a class="code" href="p4est__base_8h.html#a8deb5ddec79dfbbadf8bbbf065ec5a9c">p4est_package_id</a>, SC_LP_PRODUCTION, opt);</div>
<div class="line"> </div>
<div class="line">    step3_restart (filename, mpicomm, 0.1);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* End of program -- free allocated memory */</span></div>
<div class="line">  sc_options_destroy (opt);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* Verify that allocations internal to p4est and sc do not leak memory.</span></div>
<div class="line"><span class="comment">   * This should be called if sc_init () has been called earlier. */</span></div>
<div class="line">  sc_finalize ();</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* This is standard MPI programs.  Without --enable-mpi, this is a dummy. */</span></div>
<div class="line">  mpiret = sc_MPI_Finalize ();</div>
<div class="line">  SC_CHECK_MPI (mpiret);</div>
<div class="line">  <span class="keywordflow">return</span> usage_error ? EXIT_FAILURE : EXIT_SUCCESS;</div>
<div class="line">}</div>
<div class="ttc" id="ap4est_8h_html_a1a31375edfa42b5609e7656233c32cca"><div class="ttname"><a href="p4est_8h.html#a1a31375edfa42b5609e7656233c32cca">p4est_refine</a></div><div class="ttdeci">void p4est_refine(p4est_t *p4est, int refine_recursive, p4est_refine_t refine_fn, p4est_init_t init_fn)</div><div class="ttdoc">Refine a forest.</div></div>
<div class="ttc" id="ap4est_8h_html_a1e78f347378fe8b097ef019214f2338e"><div class="ttname"><a href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a></div><div class="ttdeci">void p4est_destroy(p4est_t *p4est)</div><div class="ttdoc">Destroy a p4est.</div></div>
<div class="ttc" id="ap4est_8h_html_a398bac71234696389c90d0f986bb31aa"><div class="ttname"><a href="p4est_8h.html#a398bac71234696389c90d0f986bb31aa">P4EST_QMAXLEVEL</a></div><div class="ttdeci">#define P4EST_QMAXLEVEL</div><div class="ttdoc">The finest level of the quadtree for representing quadrant corners.</div><div class="ttdef"><b>Definition:</b> p4est.h:59</div></div>
<div class="ttc" id="ap4est_8h_html_a54c1f4e6bc35c181952371a8046523aa"><div class="ttname"><a href="p4est_8h.html#a54c1f4e6bc35c181952371a8046523aa">p4est_partition</a></div><div class="ttdeci">void p4est_partition(p4est_t *p4est, int allow_for_coarsening, p4est_weight_t weight_fn)</div><div class="ttdoc">Equally partition the forest.</div></div>
<div class="ttc" id="ap4est_8h_html_a6b603736cf5007b14755197a9c179a85"><div class="ttname"><a href="p4est_8h.html#a6b603736cf5007b14755197a9c179a85">p4est_balance</a></div><div class="ttdeci">void p4est_balance(p4est_t *p4est, p4est_connect_type_t btype, p4est_init_t init_fn)</div><div class="ttdoc">2:1 balance the size differences of neighboring elements in a forest.</div></div>
<div class="ttc" id="ap4est_8h_html_a90acb1ef22be84e31afdec64aab60567"><div class="ttname"><a href="p4est_8h.html#a90acb1ef22be84e31afdec64aab60567">p4est_qcoord_to_vertex</a></div><div class="ttdeci">void p4est_qcoord_to_vertex(p4est_connectivity_t *connectivity, p4est_topidx_t treeid, p4est_qcoord_t x, p4est_qcoord_t y, double vxyz[3])</div><div class="ttdoc">Transform a quadrant coordinate into the space spanned by tree vertices.</div></div>
<div class="ttc" id="ap4est_8h_html_a95dd59166894e55562dd7bb741bb78c5"><div class="ttname"><a href="p4est_8h.html#a95dd59166894e55562dd7bb741bb78c5">P4EST_QUADRANT_LEN</a></div><div class="ttdeci">#define P4EST_QUADRANT_LEN(l)</div><div class="ttdoc">The length of a quadrant of level l.</div><div class="ttdef"><b>Definition:</b> p4est.h:65</div></div>
<div class="ttc" id="ap4est_8h_html_ad250f4765d9778ec3940e9fabea7c853"><div class="ttname"><a href="p4est_8h.html#ad250f4765d9778ec3940e9fabea7c853">p4est_coarsen</a></div><div class="ttdeci">void p4est_coarsen(p4est_t *p4est, int coarsen_recursive, p4est_coarsen_t coarsen_fn, p4est_init_t init_fn)</div><div class="ttdoc">Coarsen a forest.</div></div>
<div class="ttc" id="ap4est_8h_html_ae26167f0411d9845caa84be6d50c0cee"><div class="ttname"><a href="p4est_8h.html#ae26167f0411d9845caa84be6d50c0cee">P4EST_ROOT_LEN</a></div><div class="ttdeci">#define P4EST_ROOT_LEN</div><div class="ttdoc">The length of a side of the root quadrant.</div><div class="ttdef"><b>Definition:</b> p4est.h:62</div></div>
<div class="ttc" id="ap4est__base_8h_html_a05ea8ceb664ae2403fbcf7b1dcc70ea0"><div class="ttname"><a href="p4est__base_8h.html#a05ea8ceb664ae2403fbcf7b1dcc70ea0">p4est_qcoord_t</a></div><div class="ttdeci">int32_t p4est_qcoord_t</div><div class="ttdoc">Typedef for quadrant coordinates.</div><div class="ttdef"><b>Definition:</b> p4est_base.h:81</div></div>
<div class="ttc" id="ap4est__base_8h_html_a0b2d45f13b66edfed0ccfde75808c745"><div class="ttname"><a href="p4est__base_8h.html#a0b2d45f13b66edfed0ccfde75808c745">P4EST_FREE</a></div><div class="ttdeci">#define P4EST_FREE(p)</div><div class="ttdoc">free an allocated array</div><div class="ttdef"><b>Definition:</b> p4est_base.h:210</div></div>
<div class="ttc" id="ap4est__base_8h_html_a1fef909873d570158d6ac7b43c7d94f1"><div class="ttname"><a href="p4est__base_8h.html#a1fef909873d570158d6ac7b43c7d94f1">P4EST_ALLOC</a></div><div class="ttdeci">#define P4EST_ALLOC(t, n)</div><div class="ttdoc">allocate a t-array with n elements</div><div class="ttdef"><b>Definition:</b> p4est_base.h:199</div></div>
<div class="ttc" id="ap4est__base_8h_html_a8deb5ddec79dfbbadf8bbbf065ec5a9c"><div class="ttname"><a href="p4est__base_8h.html#a8deb5ddec79dfbbadf8bbbf065ec5a9c">p4est_package_id</a></div><div class="ttdeci">int p4est_package_id</div><div class="ttdoc">the libsc package id for p4est (set in p4est_init())</div></div>
<div class="ttc" id="ap4est__base_8h_html_a8e849f705b0d4d1702b8f5102823f48c"><div class="ttname"><a href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a></div><div class="ttdeci">int32_t p4est_topidx_t</div><div class="ttdoc">Typedef for counting topological entities (trees, tree vertices).</div><div class="ttdef"><b>Definition:</b> p4est_base.h:93</div></div>
<div class="ttc" id="ap4est__base_8h_html_a9f350ee78755ec6e7d25fb1dca474573"><div class="ttname"><a href="p4est__base_8h.html#a9f350ee78755ec6e7d25fb1dca474573">p4est_locidx_t</a></div><div class="ttdeci">int32_t p4est_locidx_t</div><div class="ttdoc">Typedef for processor-local indexing of quadrants and nodes.</div><div class="ttdef"><b>Definition:</b> p4est_base.h:106</div></div>
<div class="ttc" id="ap4est__base_8h_html_aab4b16aa58790d309e0cf46ed665c6b9"><div class="ttname"><a href="p4est__base_8h.html#aab4b16aa58790d309e0cf46ed665c6b9">p4est_init</a></div><div class="ttdeci">void p4est_init(sc_log_handler_t log_handler, int log_threshold)</div><div class="ttdoc">Registers p4est with the SC Library and sets the logging behavior.</div></div>
<div class="ttc" id="ap4est__base_8h_html_af4d787f9b2520af0cfe9a10b89235749"><div class="ttname"><a href="p4est__base_8h.html#af4d787f9b2520af0cfe9a10b89235749">p4est_gloidx_t</a></div><div class="ttdeci">int64_t p4est_gloidx_t</div><div class="ttdoc">Typedef for globally unique indexing of quadrants.</div><div class="ttdef"><b>Definition:</b> p4est_base.h:118</div></div>
<div class="ttc" id="ap4est__bits_8h_html"><div class="ttname"><a href="p4est__bits_8h.html">p4est_bits.h</a></div><div class="ttdoc">Routines for manipulating quadrants (neighbors, parents, children, etc.)</div></div>
<div class="ttc" id="ap4est__bits_8h_html_abf3fcf47f480c00a590f005807c71b9b"><div class="ttname"><a href="p4est__bits_8h.html#abf3fcf47f480c00a590f005807c71b9b">p4est_quadrant_parent</a></div><div class="ttdeci">void p4est_quadrant_parent(const p4est_quadrant_t *q, p4est_quadrant_t *r)</div><div class="ttdoc">Compute the parent of a quadrant.</div></div>
<div class="ttc" id="ap4est__communication_8h_html"><div class="ttname"><a href="p4est__communication_8h.html">p4est_communication.h</a></div><div class="ttdoc">Parallel messaging and support code.</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_a208e613cae5e1bd3baffb587387b672c"><div class="ttname"><a href="p4est__connectivity_8h.html#a208e613cae5e1bd3baffb587387b672c">p4est_connectivity_destroy</a></div><div class="ttdeci">void p4est_connectivity_destroy(p4est_connectivity_t *connectivity)</div><div class="ttdoc">Destroy a connectivity structure.</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_a23079dfa254ae5df731633a54a8382f0"><div class="ttname"><a href="p4est__connectivity_8h.html#a23079dfa254ae5df731633a54a8382f0">P4EST_HALF</a></div><div class="ttdeci">#define P4EST_HALF</div><div class="ttdoc">The number of children/corners touching one face.</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:77</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_a2c4786e65053166a16b7afb2711d35cb"><div class="ttname"><a href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a></div><div class="ttdeci">#define P4EST_DIM</div><div class="ttdoc">The spatial dimension.</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:71</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_ab6dcdaf6247909a4bf21a817391781a8"><div class="ttname"><a href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a></div><div class="ttdeci">#define P4EST_STRING</div><div class="ttdoc">p4est identification string</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:94</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_acb49ce9f7b688a2c6b6d62bda9ff5555"><div class="ttname"><a href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a></div><div class="ttdeci">#define P4EST_CHILDREN</div><div class="ttdoc">The number of children of a quadrant, also the number of corners.</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:75</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_adc5f6166fc408c325589ce3e620552caa33499fc87edef5b1226ade261dd0d6e6"><div class="ttname"><a href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552caa33499fc87edef5b1226ade261dd0d6e6">P4EST_CONNECT_FACE</a></div><div class="ttdeci">@ P4EST_CONNECT_FACE</div><div class="ttdoc">Balance across faces only.</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:116</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_adc5f6166fc408c325589ce3e620552caa5bf35c11d90c02cb481e9edadb51bda7"><div class="ttname"><a href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552caa5bf35c11d90c02cb481e9edadb51bda7">P4EST_CONNECT_FULL</a></div><div class="ttdeci">@ P4EST_CONNECT_FULL</div><div class="ttdoc">= CORNER.</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:119</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_ae65fe72b77b6f6c6825fc33efc101dab"><div class="ttname"><a href="p4est__connectivity_8h.html#ae65fe72b77b6f6c6825fc33efc101dab">p4est_connectivity_new_periodic</a></div><div class="ttdeci">p4est_connectivity_t * p4est_connectivity_new_periodic(void)</div><div class="ttdoc">Create a connectivity structure for an all-periodic unit square.</div></div>
<div class="ttc" id="ap4est__extended_8h_html"><div class="ttname"><a href="p4est__extended_8h.html">p4est_extended.h</a></div><div class="ttdoc">Interface routines with extended capabilities.</div></div>
<div class="ttc" id="ap4est__extended_8h_html_a06630b99f70cb85c73452640e8b4d54e"><div class="ttname"><a href="p4est__extended_8h.html#a06630b99f70cb85c73452640e8b4d54e">p4est_coarsen_ext</a></div><div class="ttdeci">void p4est_coarsen_ext(p4est_t *p4est, int coarsen_recursive, int callback_orphans, p4est_coarsen_t coarsen_fn, p4est_init_t init_fn, p4est_replace_t replace_fn)</div><div class="ttdoc">Coarsen a forest.</div></div>
<div class="ttc" id="ap4est__extended_8h_html_a666a197be8d6d83c08cc14bfdc8565ed"><div class="ttname"><a href="p4est__extended_8h.html#a666a197be8d6d83c08cc14bfdc8565ed">p4est_balance_ext</a></div><div class="ttdeci">void p4est_balance_ext(p4est_t *p4est, p4est_connect_type_t btype, p4est_init_t init_fn, p4est_replace_t replace_fn)</div><div class="ttdoc">2:1 balance the size differences of neighboring elements in a forest.</div></div>
<div class="ttc" id="ap4est__extended_8h_html_aad32df9df3630b6bac05e7366a5f1e46"><div class="ttname"><a href="p4est__extended_8h.html#aad32df9df3630b6bac05e7366a5f1e46">p4est_refine_ext</a></div><div class="ttdeci">void p4est_refine_ext(p4est_t *p4est, int refine_recursive, int maxlevel, p4est_refine_t refine_fn, p4est_init_t init_fn, p4est_replace_t replace_fn)</div><div class="ttdoc">Refine a forest with a bounded refinement level and a replace option.</div></div>
<div class="ttc" id="ap4est__extended_8h_html_ac11cf572e8ac72c4beb78465f98b63f3"><div class="ttname"><a href="p4est__extended_8h.html#ac11cf572e8ac72c4beb78465f98b63f3">p4est_new_ext</a></div><div class="ttdeci">p4est_t * p4est_new_ext(sc_MPI_Comm mpicomm, p4est_connectivity_t *connectivity, p4est_locidx_t min_quadrants, int min_level, int fill_uniform, size_t data_size, p4est_init_t init_fn, void *user_pointer)</div><div class="ttdoc">Create a new forest.</div></div>
<div class="ttc" id="ap4est__ghost_8h_html_a34a0bfb7169437f6fc2382a67c47e89d"><div class="ttname"><a href="p4est__ghost_8h.html#a34a0bfb7169437f6fc2382a67c47e89d">p4est_ghost_new</a></div><div class="ttdeci">p4est_ghost_t * p4est_ghost_new(p4est_t *p4est, p4est_connect_type_t btype)</div><div class="ttdoc">Builds the ghost layer.</div></div>
<div class="ttc" id="ap4est__ghost_8h_html_a4b4ae4fa996d0b8705d6267953c3e757"><div class="ttname"><a href="p4est__ghost_8h.html#a4b4ae4fa996d0b8705d6267953c3e757">p4est_ghost_destroy</a></div><div class="ttdeci">void p4est_ghost_destroy(p4est_ghost_t *ghost)</div><div class="ttdoc">Frees all memory used for the ghost layer.</div></div>
<div class="ttc" id="ap4est__ghost_8h_html_a58908a7bf0810077c99a6ddccc642fcd"><div class="ttname"><a href="p4est__ghost_8h.html#a58908a7bf0810077c99a6ddccc642fcd">p4est_ghost_exchange_data</a></div><div class="ttdeci">void p4est_ghost_exchange_data(p4est_t *p4est, p4est_ghost_t *ghost, void *ghost_data)</div><div class="ttdoc">Transfer data for local quadrants that are ghosts to other processors.</div></div>
<div class="ttc" id="ap4est__io_8h_html"><div class="ttname"><a href="p4est__io_8h.html">p4est_io.h</a></div><div class="ttdoc">Provide functions to serialize/deserialize a forest.</div></div>
<div class="ttc" id="ap4est__iterate_8h_html"><div class="ttname"><a href="p4est__iterate_8h.html">p4est_iterate.h</a></div><div class="ttdoc">Iteration over mesh topology via callbacks.</div></div>
<div class="ttc" id="ap4est__iterate_8h_html_aca75de06c7e9f039fa3be925a6ae87b4"><div class="ttname"><a href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a></div><div class="ttdeci">void p4est_iterate(p4est_t *p4est, p4est_ghost_t *ghost_layer, void *user_data, p4est_iter_volume_t iter_volume, p4est_iter_face_t iter_face, p4est_iter_corner_t iter_corner)</div><div class="ttdoc">Execute user supplied callbacks at every volume, face, and corner in the local forest.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html"><div class="ttname"><a href="p4est__vtk_8h.html">p4est_vtk.h</a></div><div class="ttdoc">Routines for printing a forest and associated fields to VTK format.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a16f7a68833130a721eea8dab489cd69f"><div class="ttname"><a href="p4est__vtk_8h.html#a16f7a68833130a721eea8dab489cd69f">p4est_vtk_write_point_dataf</a></div><div class="ttdeci">p4est_vtk_context_t * p4est_vtk_write_point_dataf(p4est_vtk_context_t *cont, int num_point_scalars, int num_point_vectors,...)</div><div class="ttdoc">Write VTK point data.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a17ce523f11f580944630c6c604a070da"><div class="ttname"><a href="p4est__vtk_8h.html#a17ce523f11f580944630c6c604a070da">p4est_vtk_write_header</a></div><div class="ttdeci">p4est_vtk_context_t * p4est_vtk_write_header(p4est_vtk_context_t *cont)</div><div class="ttdoc">Write the VTK header.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a23950ebd8b9b99877fa152752b5150d4"><div class="ttname"><a href="p4est__vtk_8h.html#a23950ebd8b9b99877fa152752b5150d4">p4est_vtk_write_footer</a></div><div class="ttdeci">int p4est_vtk_write_footer(p4est_vtk_context_t *cont)</div><div class="ttdoc">Write the VTU footer and clean up.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a34dbafa8dbc61172ead1a4da4c7103ca"><div class="ttname"><a href="p4est__vtk_8h.html#a34dbafa8dbc61172ead1a4da4c7103ca">p4est_vtk_context_new</a></div><div class="ttdeci">p4est_vtk_context_t * p4est_vtk_context_new(p4est_t *p4est, const char *filename)</div><div class="ttdoc">The first call to write a VTK file using individual functions.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a7120e8be889eed8a43a781db9f12f00a"><div class="ttname"><a href="p4est__vtk_8h.html#a7120e8be889eed8a43a781db9f12f00a">p4est_vtk_write_cell_dataf</a></div><div class="ttdeci">p4est_vtk_context_t * p4est_vtk_write_cell_dataf(p4est_vtk_context_t *cont, int write_tree, int write_level, int write_rank, int wrap_rank, int num_cell_scalars, int num_cell_vectors,...)</div><div class="ttdoc">Write VTK cell data.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_aa6d374056a42e8bf6245cf0789e117c0"><div class="ttname"><a href="p4est__vtk_8h.html#aa6d374056a42e8bf6245cf0789e117c0">p4est_vtk_context_set_scale</a></div><div class="ttdeci">void p4est_vtk_context_set_scale(p4est_vtk_context_t *cont, double scale)</div><div class="ttdoc">Modify the context parameter for scaling the quadrants.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_aec7e360e192839f06f58cbfc7afb6d6c"><div class="ttname"><a href="p4est__vtk_8h.html#aec7e360e192839f06f58cbfc7afb6d6c">p4est_vtk_context_t</a></div><div class="ttdeci">struct p4est_vtk_context p4est_vtk_context_t</div><div class="ttdoc">Opaque context type for writing VTK output with multiple function calls.</div><div class="ttdef"><b>Definition:</b> p4est_vtk.h:42</div></div>
<div class="ttc" id="ap8est__bits_8h_html"><div class="ttname"><a href="p8est__bits_8h.html">p8est_bits.h</a></div><div class="ttdoc">Routines for manipulating quadrants (neighbors, parents, children, etc.)</div></div>
<div class="ttc" id="ap8est__communication_8h_html"><div class="ttname"><a href="p8est__communication_8h.html">p8est_communication.h</a></div><div class="ttdoc">Parallel messaging and support code.</div></div>
<div class="ttc" id="ap8est__connectivity_8h_html_a1374c4c2fc06e436e047d32c28b87288"><div class="ttname"><a href="p8est__connectivity_8h.html#a1374c4c2fc06e436e047d32c28b87288">p8est_connectivity_new_periodic</a></div><div class="ttdeci">p8est_connectivity_t * p8est_connectivity_new_periodic(void)</div><div class="ttdoc">Create a connectivity structure for an all-periodic unit cube.</div></div>
<div class="ttc" id="ap8est__extended_8h_html"><div class="ttname"><a href="p8est__extended_8h.html">p8est_extended.h</a></div><div class="ttdoc">Interface routines with extended capabilities.</div></div>
<div class="ttc" id="ap8est__io_8h_html"><div class="ttname"><a href="p8est__io_8h.html">p8est_io.h</a></div><div class="ttdoc">Provide functions to serialize/deserialize a forest.</div></div>
<div class="ttc" id="ap8est__iterate_8h_html"><div class="ttname"><a href="p8est__iterate_8h.html">p8est_iterate.h</a></div><div class="ttdoc">Iteration over mesh topology via callbacks.</div></div>
<div class="ttc" id="ap8est__vtk_8h_html"><div class="ttname"><a href="p8est__vtk_8h.html">p8est_vtk.h</a></div><div class="ttdoc">Routines for printing a forest and associated fields to VTK format.</div></div>
<div class="ttc" id="astructp4est__connectivity_html"><div class="ttname"><a href="structp4est__connectivity.html">p4est_connectivity</a></div><div class="ttdoc">This structure holds the 2D inter-tree connectivity information.</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:190</div></div>
<div class="ttc" id="astructp4est__ghost_html"><div class="ttname"><a href="structp4est__ghost.html">p4est_ghost</a></div><div class="ttdoc">Quadrants that neighbor the local domain.</div><div class="ttdef"><b>Definition:</b> p4est_ghost.h:46</div></div>
<div class="ttc" id="astructp4est__iter__face__info_html"><div class="ttname"><a href="structp4est__iter__face__info.html">p4est_iter_face_info</a></div><div class="ttdoc">The information that is available to the user-defined p4est_iter_face_t callback.</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:124</div></div>
<div class="ttc" id="astructp4est__iter__face__side__full_html_a89f38f0bf009c7448bdf7d97884ce2d3"><div class="ttname"><a href="structp4est__iter__face__side__full.html#a89f38f0bf009c7448bdf7d97884ce2d3">p4est_iter_face_side_full::quad</a></div><div class="ttdeci">p4est_quadrant_t * quad</div><div class="ttdoc">the actual quadrant</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:69</div></div>
<div class="ttc" id="astructp4est__iter__face__side__full_html_aad5d25e815207300384b82840f126d44"><div class="ttname"><a href="structp4est__iter__face__side__full.html#aad5d25e815207300384b82840f126d44">p4est_iter_face_side_full::quadid</a></div><div class="ttdeci">p4est_locidx_t quadid</div><div class="ttdoc">index in tree or ghost array</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:70</div></div>
<div class="ttc" id="astructp4est__iter__face__side__hanging_html_a16fc5a7f97d0b39657797658d5afab3e"><div class="ttname"><a href="structp4est__iter__face__side__hanging.html#a16fc5a7f97d0b39657797658d5afab3e">p4est_iter_face_side_hanging::quad</a></div><div class="ttdeci">p4est_quadrant_t * quad[2]</div><div class="ttdoc">the actual quadrant</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:79</div></div>
<div class="ttc" id="astructp4est__iter__face__side__hanging_html_adcfe28552cc20c79095e062a7d3129ca"><div class="ttname"><a href="structp4est__iter__face__side__hanging.html#adcfe28552cc20c79095e062a7d3129ca">p4est_iter_face_side_hanging::quadid</a></div><div class="ttdeci">p4est_locidx_t quadid[2]</div><div class="ttdoc">index in tree or ghost array</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:80</div></div>
<div class="ttc" id="astructp4est__iter__face__side_html"><div class="ttname"><a href="structp4est__iter__face__side.html">p4est_iter_face_side</a></div><div class="ttdoc">Information about one side of a face in the forest.</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:94</div></div>
<div class="ttc" id="astructp4est__iter__face__side_html_a437fc601ac99c21e9a2d541b904042b7"><div class="ttname"><a href="structp4est__iter__face__side.html#a437fc601ac99c21e9a2d541b904042b7">p4est_iter_face_side::face</a></div><div class="ttdeci">int8_t face</div><div class="ttdoc">which quadrant side the face touches</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:96</div></div>
<div class="ttc" id="astructp4est__iter__volume__info_html"><div class="ttname"><a href="structp4est__iter__volume__info.html">p4est_iter_volume_info</a></div><div class="ttdoc">The information that is available to the user-defined p4est_iter_volume_t callback function.</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:47</div></div>
<div class="ttc" id="astructp4est__iter__volume__info_html_a1e9040be1cad1838d0407c1cc01e5122"><div class="ttname"><a href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">p4est_iter_volume_info::quad</a></div><div class="ttdeci">p4est_quadrant_t * quad</div><div class="ttdoc">the quadrant of the callback</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:50</div></div>
<div class="ttc" id="astructp4est__iter__volume__info_html_a47f7123c64fa71ba536b971525d9678e"><div class="ttname"><a href="structp4est__iter__volume__info.html#a47f7123c64fa71ba536b971525d9678e">p4est_iter_volume_info::quadid</a></div><div class="ttdeci">p4est_locidx_t quadid</div><div class="ttdoc">id in quad's tree array (see p4est_tree_t)</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:51</div></div>
<div class="ttc" id="astructp4est__iter__volume__info_html_aa9203b989bb29cc3ff536dd224727ab4"><div class="ttname"><a href="structp4est__iter__volume__info.html#aa9203b989bb29cc3ff536dd224727ab4">p4est_iter_volume_info::treeid</a></div><div class="ttdeci">p4est_topidx_t treeid</div><div class="ttdoc">the tree containing quad</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:53</div></div>
<div class="ttc" id="astructp4est__quadrant_html"><div class="ttname"><a href="structp4est__quadrant.html">p4est_quadrant</a></div><div class="ttdoc">The 2D quadrant datatype.</div><div class="ttdef"><b>Definition:</b> p4est.h:76</div></div>
<div class="ttc" id="astructp4est__quadrant_html_a0f92ad9bd71d9e3f82246d2768ff23ad"><div class="ttname"><a href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">p4est_quadrant::level</a></div><div class="ttdeci">int8_t level</div><div class="ttdoc">level of refinement</div><div class="ttdef"><b>Definition:</b> p4est.h:80</div></div>
<div class="ttc" id="astructp4est__quadrant_html_a84896efd4c9ace3225253e379fb48a6e"><div class="ttname"><a href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p4est_quadrant::p</a></div><div class="ttdeci">union p4est_quadrant::p4est_quadrant_data p</div><div class="ttdoc">a union of additional data attached to a quadrant</div></div>
<div class="ttc" id="astructp4est__quadrant_html_ad226034132b973fe7955ef797938dea0"><div class="ttname"><a href="structp4est__quadrant.html#ad226034132b973fe7955ef797938dea0">p4est_quadrant::y</a></div><div class="ttdeci">p4est_qcoord_t y</div><div class="ttdoc">coordinates</div><div class="ttdef"><b>Definition:</b> p4est.h:78</div></div>
<div class="ttc" id="astructp4est__tree_html"><div class="ttname"><a href="structp4est__tree.html">p4est_tree</a></div><div class="ttdoc">The p4est tree datatype.</div><div class="ttdef"><b>Definition:</b> p4est.h:129</div></div>
<div class="ttc" id="astructp4est__tree_html_a93ee1718ce000fa3468848fb1673a689"><div class="ttname"><a href="structp4est__tree.html#a93ee1718ce000fa3468848fb1673a689">p4est_tree::maxlevel</a></div><div class="ttdeci">int8_t maxlevel</div><div class="ttdoc">highest local quadrant level</div><div class="ttdef"><b>Definition:</b> p4est.h:138</div></div>
<div class="ttc" id="astructp4est__tree_html_ab0248e174f0d63c76bbe1ba955f732be"><div class="ttname"><a href="structp4est__tree.html#ab0248e174f0d63c76bbe1ba955f732be">p4est_tree::quadrants_offset</a></div><div class="ttdeci">p4est_locidx_t quadrants_offset</div><div class="ttdoc">cumulative sum over earlier trees on this processor (locals only)</div><div class="ttdef"><b>Definition:</b> p4est.h:133</div></div>
<div class="ttc" id="astructp4est_html"><div class="ttname"><a href="structp4est.html">p4est</a></div><div class="ttdoc">The p4est forest datatype.</div><div class="ttdef"><b>Definition:</b> p4est.h:150</div></div>
<div class="ttc" id="astructp4est_html_a124d4dc0b8cd3b07351de80f19351beb"><div class="ttname"><a href="structp4est.html#a124d4dc0b8cd3b07351de80f19351beb">p4est::first_local_tree</a></div><div class="ttdeci">p4est_topidx_t first_local_tree</div><div class="ttdoc">0-based index of first local tree, must be -1 for an empty processor</div><div class="ttdef"><b>Definition:</b> p4est.h:161</div></div>
<div class="ttc" id="astructp4est_html_a2ca31d19479e82d49a7dd3a4f2d48011"><div class="ttname"><a href="structp4est.html#a2ca31d19479e82d49a7dd3a4f2d48011">p4est::connectivity</a></div><div class="ttdeci">p4est_connectivity_t * connectivity</div><div class="ttdoc">connectivity structure, not owned</div><div class="ttdef"><b>Definition:</b> p4est.h:177</div></div>
<div class="ttc" id="astructp4est_html_a40324cbcc175d48f887735afd5c4239f"><div class="ttname"><a href="structp4est.html#a40324cbcc175d48f887735afd5c4239f">p4est::local_num_quadrants</a></div><div class="ttdeci">p4est_locidx_t local_num_quadrants</div><div class="ttdoc">number of quadrants on all trees on this processor</div><div class="ttdef"><b>Definition:</b> p4est.h:167</div></div>
<div class="ttc" id="astructp4est_html_a486eacc9c8e6ce28ff34429d297e703f"><div class="ttname"><a href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">p4est::user_pointer</a></div><div class="ttdeci">void * user_pointer</div><div class="ttdoc">convenience pointer for users, never touched by p4est</div><div class="ttdef"><b>Definition:</b> p4est.h:157</div></div>
<div class="ttc" id="astructp4est_html_a6158d35a403f1dbec23833746c5b4a8b"><div class="ttname"><a href="structp4est.html#a6158d35a403f1dbec23833746c5b4a8b">p4est::trees</a></div><div class="ttdeci">sc_array_t * trees</div><div class="ttdoc">array of all trees</div><div class="ttdef"><b>Definition:</b> p4est.h:178</div></div>
<div class="ttc" id="astructp4est_html_a88446986bafb8d46456976515b22c856"><div class="ttname"><a href="structp4est.html#a88446986bafb8d46456976515b22c856">p4est::mpicomm</a></div><div class="ttdeci">sc_MPI_Comm mpicomm</div><div class="ttdoc">MPI communicator.</div><div class="ttdef"><b>Definition:</b> p4est.h:151</div></div>
<div class="ttc" id="astructp4est_html_abd072c07f3197827fe22c16379de6ab8"><div class="ttname"><a href="structp4est.html#abd072c07f3197827fe22c16379de6ab8">p4est::last_local_tree</a></div><div class="ttdeci">p4est_topidx_t last_local_tree</div><div class="ttdoc">0-based index of last local tree, must be -2 for an empty processor</div><div class="ttdef"><b>Definition:</b> p4est.h:164</div></div>
<div class="ttc" id="aunionp4est__iter__face__side_1_1p4est__iter__face__side__data_html_aab4d82c9073b31abd091d5383a69b63c"><div class="ttname"><a href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#aab4d82c9073b31abd091d5383a69b63c">p4est_iter_face_side::p4est_iter_face_side_data::hanging</a></div><div class="ttdeci">p4est_iter_face_side_hanging_t hanging</div><div class="ttdoc">if is_hanging, use is.hanging to access per-quadrant data</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:106</div></div>
<div class="ttc" id="aunionp4est__iter__face__side_1_1p4est__iter__face__side__data_html_abb2075c4a1ed0a326779d6c1462fefe2"><div class="ttname"><a href="unionp4est__iter__face__side_1_1p4est__iter__face__side__data.html#abb2075c4a1ed0a326779d6c1462fefe2">p4est_iter_face_side::p4est_iter_face_side_data::full</a></div><div class="ttdeci">p4est_iter_face_side_full_t full</div><div class="ttdoc">if !is_hanging, use is.full to access per-quadrant data</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:103</div></div>
<div class="ttc" id="aunionp4est__quadrant_1_1p4est__quadrant__data_html_aff6684573d249ebf6af9f035aff5e1a0"><div class="ttname"><a href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">p4est_quadrant::p4est_quadrant_data::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdoc">never changed by p4est</div><div class="ttdef"><b>Definition:</b> p4est.h:94</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
</body>
</html>
