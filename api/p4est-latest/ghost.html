<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>p4est: The ghost layer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">p4est
   &#160;<span id="projectnumber">2.8.6.259-54a6</span>
   </div>
   <div id="projectbrief">p4est is a software library for parallel adaptive mesh refinement.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The ghost layer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>An overview of the ghost layer functionalities.</p>
<h2><a class="anchor" id="autotoc_md26"></a>
The basic idea and definition</h2>
<p>Mesh-based computations may require access to neighboring elements. An example of such a computation using a ghost layer can be found in <a class="el" href="steps_2p4est_step3_8c-example.html">steps/p4est_step3.c</a> (2D) and <a class="el" href="steps_2p8est_step3_8c-example.html">steps/p8est_step3.c</a> (3D) &ndash; a simple parallel advection solver. For parallel computations, we we need to ensure that neighboring mesh elements, which are not local to the current process, become accessible locally. The need of process-neighboring mesh elements leads to the definition of the ghost (a.k.a. halo) layer: The ghost layer is the set of all remote, i.e. non-local, mesh elements that are adjacent to the process-local mesh elements. This data structure is ideally suited to establish the communication pattern between mesh-adjacent parallel processes. The ghost layer contains all information required to determine all sender-receiver pairs without additional MPI communication. The pattern is necessarily symmetric: Each sender of a pair is also a receiver and vice versa.</p>
<h2><a class="anchor" id="autotoc_md27"></a>
Constructing the ghost layer</h2>
<p><b><a class="el" href="structp4est.html" title="The p4est forest datatype.">p4est</a></b> provides the functions <a class="el" href="p4est__ghost_8h.html#a34a0bfb7169437f6fc2382a67c47e89d">p4est_ghost_new</a> (2D), <a class="el" href="p8est__ghost_8h.html#a4767b342e1f1e6f0efe4fa9eca702a72">p8est_ghost_new</a> (3D) to construct a ghost layer. A ghost layer can be constructed from a valid <b>input_p4est</b> (cf. <a class="el" href="p4est_8h.html#abbf85f084ef575fb279717eba3aba29c">p4est_t</a> (2D), <a class="el" href="p8est_8h.html#a65f9b454e1c28c2c9f60ab4a967126af">p8est_t</a> (3D) and <a class="el" href="p4est__algorithms_8h.html#a1f8490aec3259f0f537cdf6b0473cf8c">p4est_is_valid</a> (2D), <a class="el" href="p8est__algorithms_8h.html#ad964a86bf6f8dfd48ec03787b750abd7">p8est_is_valid</a> (3D)). The forest does not need to be 2:1 balanced.</p>
<p>The second and last required parameter to construct a ghost layer is a <b>btype</b> (cf. <a class="el" href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552ca">p4est_connect_type_t</a> (2D), <a class="el" href="p8est__connectivity_8h.html#aaa5a9d47d1b169507e1095783ab89be1">p8est_connect_type_t</a> (3D)) that specifies if the ghost layer should collect face adjacency, face and edge adjacency in 3D, or full adjacency including corner neighbors.</p>
<p>Ghost layer construction in 2D: </p><blockquote class="doxtable">
<p><code>ghost = p4est_ghost_new (input_p4est, btype)</code> </p>
</blockquote>
<p>The returned ghost layer object is explained in the following section.</p>
<h2><a class="anchor" id="autotoc_md28"></a>
The ghost data structure</h2>
<p>The ghost layer object (cf. <a class="el" href="p4est__ghost_8h.html#aaa1000659b80aeb802788aac34dcbf5c">p4est_ghost_t</a> (2D), <a class="el" href="p8est__ghost_8h.html#a01f7ba9154de22adb8e8f8c342d697ba">p8est_ghost_t</a> (3D)) can be queried and searched without accessing the original <b>input_p4est</b>. It is read-only immutable and must be destroyed when no longer needed (cf. <a class="el" href="p4est__ghost_8h.html#a4b4ae4fa996d0b8705d6267953c3e757">p4est_ghost_destroy</a> (2D), <a class="el" href="p8est__ghost_8h.html#a09828751923b505ed8faf51e2882f003">p8est_ghost_destroy</a> (3D)).</p>
<h3><a class="anchor" id="autotoc_md29"></a>
Elements of the ghost layer</h3>
<p>The ghost layer is a public struct with documented entries, most of them arrays. The <a class="el" href="p4est__ghost_8h.html#aaa1000659b80aeb802788aac34dcbf5c">2D</a> and <a class="el" href="p8est__ghost_8h.html#a01f7ba9154de22adb8e8f8c342d697ba">3D</a> declarations are structurally identical: Linear tree storage is dimension independent, and ghost elements are ordered ascending just as mesh elements. We may index into the element storage by window start and offset indices. We may also use binary search in the linear order to find ghost elements.</p>
<p>The elements of the ghost layer start with the <a class="el" href="structp4est__ghost.html#af58ab604831865823b378ba79089a1ec">mpisize</a> and <a class="el" href="structp4est__ghost.html#a54a38e31c829e101c916765ac82a4a6f">num_trees</a>. They store the number of MPI ranks and the number of trees of the ghost layer. Both elements are as in the <a class="el" href="group__p4est.html">p4est</a> that was used to construct the ghost layer.</p>
<p>The array <a class="el" href="structp4est__ghost.html#a06a0c2dfa2f05929d58ed85f0117228c">ghosts</a> stores the ghost elements that form the ghost layer of the process-local elements. The <a class="el" href="p4est_8h.html#af07461000cd68b5cd5e38b2e66b7f67b">quadrants</a> in the <a class="el" href="structp4est__ghost.html#a06a0c2dfa2f05929d58ed85f0117228c">ghosts</a> array store their tree index and the local number in the owner's numbering in <a class="el" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#ac515f7cf5f7e1ba9772ee185f3ad98f0">piggy3</a>. The <a class="el" href="structp4est__ghost.html#a06a0c2dfa2f05929d58ed85f0117228c">ghosts</a> array is windowed by the two arrays <a class="el" href="structp4est__ghost.html#ab6c23fe9fab99f812d40b24ff9afd7c1">tree_offsets</a> and <a class="el" href="structp4est__ghost.html#a87fb2e3a4a30c06e09566ff65a14b12d">proc_offsets</a>. Therefore, the MPI rank and the tree number of each element in <a class="el" href="structp4est__ghost.html#a06a0c2dfa2f05929d58ed85f0117228c">ghosts</a> can be deduced. Naturally, some trees or processes may have zero ghost elements for a given process, in which case the window has length zero.</p>
<p>The <a class="el" href="structp4est__ghost.html#a5d9a6ee5863c5fc3264b440849324888">mirrors</a> array stores all local quadrants that are ghosts to remote processes, sometimes called the (inside) parallel boundary elements. <a class="el" href="structp4est__ghost.html#a06a0c2dfa2f05929d58ed85f0117228c">ghosts</a> can be considered as the outside parallel boundary elements. One mirror quadrant may be ghost to more than one remote process. Thus, the indexing structure is slightly less direct than for <a class="el" href="structp4est__ghost.html#a06a0c2dfa2f05929d58ed85f0117228c">ghosts</a>: We have an array <a class="el" href="structp4est__ghost.html#ad71ab27aec27b091153a4fdc8a4515f3">mirror_proc_mirrors</a> that contains one set of indices into the <a class="el" href="structp4est__ghost.html#a5d9a6ee5863c5fc3264b440849324888">mirrors</a> for each remote process. The array <a class="el" href="structp4est__ghost.html#a5ab6b80790c11b4752d2ecf198954f9b">mirror_proc_offsets</a> indexes into these sets, which vary in length by the remote process. As for <a class="el" href="structp4est__ghost.html#a06a0c2dfa2f05929d58ed85f0117228c">ghosts</a>, we have for <a class="el" href="structp4est__ghost.html#a5d9a6ee5863c5fc3264b440849324888">mirrors</a> also an array with tree offsets, namely the array <a class="el" href="structp4est__ghost.html#a46788f88d0ca86e8361c821c54386dd6">mirror_tree_offsets</a>.</p>
<h2><a class="anchor" id="autotoc_md30"></a>
Find more information</h2>
<p>For further elements of the ghost data structure see also <a class="el" href="p4est__ghost_8h.html#aaa1000659b80aeb802788aac34dcbf5c">p4est_ghost_t</a> and <a class="el" href="p8est__ghost_8h.html#a01f7ba9154de22adb8e8f8c342d697ba">p8est_ghost_t</a> and for parallel ghost data exchange functions see the respective functions in <a class="el" href="p4est__ghost_8h.html">p4est_ghost.h</a> (2D) and <a class="el" href="p8est__ghost_8h.html">p8est_ghost.h</a> (3D).</p>
<h2><a class="anchor" id="autotoc_md31"></a>
Example of ghost usage</h2>
<p>Besides the already mentioned parallel advection solver in <a class="el" href="steps_2p4est_step3_8c-example.html">2D</a> and <a class="el" href="steps_2p8est_step3_8c-example.html">3D</a>, one can also find a simple synthetic usage examples of ghost in <a class="el" href="timings_2timings2_8c-example.html">timings/timings2.c</a> (2D) and <a class="el" href="timings_2timings3_8c-example.html">timings/timings3.c</a> (3D). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
</body>
</html>
