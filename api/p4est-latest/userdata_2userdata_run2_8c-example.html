<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>p4est: userdata/userdata_run2.c</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">p4est
   &#160;<span id="projectnumber">2.8.6.259-54a6</span>
   </div>
   <div id="projectbrief">p4est is a software library for parallel adaptive mesh refinement.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="headertitle">
<div class="title">userdata/userdata_run2.c</div>  </div>
</div><!--header-->
<div class="contents">
<p>A 2D example of managing application data: <b>core code</b>.The workflow is documented more extensively in <a class="el" href="example_userdata.html">A demonstration of how to manage application data</a>.</p>
<p>This file contains the code compiled for both the 2D and 3D demo. This is accomplished with only minimal redefinitions. We write the code only once and use it twice. The 3D source <a class="el" href="userdata_2userdata_run3_8c-example.html">userdata/userdata_run3.c</a> is a formal wrapper. In this sense, the code is mostly dimension independent.</p>
<p>This file contains the detailed code of the demo. Its entry point is called from <a class="el" href="userdata_2userdata2_8c-example.html">userdata/userdata2.c</a>, which is a good example of setting up a <b>main program</b> and defining and parsing command line options.</p>
<div class="fragment"><div class="line"><span class="comment">/*</span></div>
<div class="line"><span class="comment">  This file is part of p4est.</span></div>
<div class="line"><span class="comment">  p4est is a C library to manage a collection (a forest) of multiple</span></div>
<div class="line"><span class="comment">  connected adaptive quadtrees or octrees in parallel.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  Copyright (C) 2010 The University of Texas System</span></div>
<div class="line"><span class="comment">  Additional copyright (C) 2011 individual authors</span></div>
<div class="line"><span class="comment">  Written by Carsten Burstedde, Lucas C. Wilcox, and Tobin Isaac</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  p4est is free software; you can redistribute it and/or modify</span></div>
<div class="line"><span class="comment">  it under the terms of the GNU General Public License as published by</span></div>
<div class="line"><span class="comment">  the Free Software Foundation; either version 2 of the License, or</span></div>
<div class="line"><span class="comment">  (at your option) any later version.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  p4est is distributed in the hope that it will be useful,</span></div>
<div class="line"><span class="comment">  but WITHOUT ANY WARRANTY; without even the implied warranty of</span></div>
<div class="line"><span class="comment">  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></div>
<div class="line"><span class="comment">  GNU General Public License for more details.</span></div>
<div class="line"><span class="comment"></span> </div>
<div class="line"><span class="comment">  You should have received a copy of the GNU General Public License</span></div>
<div class="line"><span class="comment">  along with p4est; if not, write to the Free Software Foundation, Inc.,</span></div>
<div class="line"><span class="comment">  51 Franklin Street, Fifth Floor, Boston, MA 02110-1301, USA.</span></div>
<div class="line"><span class="comment">*/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* the core functionality of the exmple program, for both 2D and 3D */</span></div>
<div class="line"><span class="preprocessor">#include &quot;userdata_global.h&quot;</span></div>
<div class="line"><span class="preprocessor">#ifndef P4_TO_P8</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__bits_8h.html">p4est_bits.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__communication_8h.html">p4est_communication.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__extended_8h.html">p4est_extended.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p4est__vtk_8h.html">p4est_vtk.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__bits_8h.html">p8est_bits.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__communication_8h.html">p8est_communication.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__extended_8h.html">p8est_extended.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;<a class="code" href="p8est__vtk_8h.html">p8est_vtk.h</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/************ code used regardless of internal or external data **************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* demonstration data for each quadrant */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>userdata_quadrant_internal</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* Store a piecewise constant variable field. */</span></div>
<div class="line">  <span class="keywordtype">double</span>              value;</div>
<div class="line">}</div>
<div class="line">userdata_quadrant_internal_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* analytic solution function for demonstration purposes */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span></div>
<div class="line">userdata_analytic (p4est_userdata_global_t *g, <span class="keyword">const</span> <span class="keywordtype">double</span> coords[3])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordflow">return</span></div>
<div class="line">    .5 * sin (M_PI * coords[0]) +</div>
<div class="line">    .25 * exp (-.5 * pow ((coords[1] - .5) / 2.5, 2.)) +</div>
<div class="line">    .25 * cos (4. * M_PI * coords[2]);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* compute the value of the given function at quadrant midpoint */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">double</span></div>
<div class="line">userdata_value (p4est_userdata_global_t *g,</div>
<div class="line">                <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree, <a name="_a0"></a><a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> *quadrant)</div>
<div class="line">{</div>
<div class="line">  <a class="code" href="p4est__base_8h.html#a05ea8ceb664ae2403fbcf7b1dcc70ea0">p4est_qcoord_t</a>      coords_in[<a name="a1"></a><a class="code" href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a>];</div>
<div class="line">  <span class="keywordtype">double</span>              coords_out[3];</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* transform quadrant midpoint into the geometry system */</span></div>
<div class="line">  <a name="a2"></a><a class="code" href="p4est__bits_8h.html#a1c0bd87bc88f3389fa5f224922ce060a">p4est_quadrant_volume_coordinates</a> (quadrant, coords_in);</div>
<div class="line">  <a name="a3"></a><a class="code" href="p4est__geometry_8h.html#a699f3bd91e2560abeafc23322e12f0c3">p4est_geometry_transform_coordinates</a> (g-&gt;geom, which_tree,</div>
<div class="line">                                        coords_in, coords_out);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* evaluate function at this point */</span></div>
<div class="line">  <span class="keywordflow">return</span> userdata_analytic (g, coords_out);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* wrapper for an iteration over every local element */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_iterate_volume (p4est_userdata_global_t *g,</div>
<div class="line">                         <a name="a4"></a><a class="code" href="p4est__iterate_8h.html#adb709fe6510c4f0b3a918d2f976dbfbc">p4est_iter_volume_t</a> volume_callback)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* iterate over local quadrants passing an arbitrary callback */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == 0);</div>
<div class="line">  <a name="a5"></a><a class="code" href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a> (g-&gt;p4est, NULL, g, volume_callback, NULL,</div>
<div class="line">#ifdef P4_TO_P8</div>
<div class="line">                 NULL,</div>
<div class="line">#endif</div>
<div class="line">                 NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  g-&gt;qcount = 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* write a VTK file with the mesh and the element data */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_vtk_general (p4est_userdata_global_t *g, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename)</div>
<div class="line">{</div>
<div class="line">  <span class="keyword">const</span> <span class="keywordtype">char</span>         *fnames[1] = { <span class="stringliteral">&quot;value&quot;</span> };</div>
<div class="line">  sc_array_t         *fvalues[1] = { NULL };</div>
<div class="line">  <a class="code" href="p4est__vtk_8h.html#aec7e360e192839f06f58cbfc7afb6d6c">p4est_vtk_context_t</a> *vtk, *rvtk;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* check preconditions */</span></div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;p4est != NULL);</div>
<div class="line">  P4EST_ASSERT (!g-&gt;novtk);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* verify structure of VTK data */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray-&gt;elem_size == sizeof (<span class="keywordtype">double</span>));</div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray-&gt;elem_count ==</div>
<div class="line">                (<span class="keywordtype">size_t</span>) g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  fvalues[0] = g-&gt;qarray;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write file in multpile steps */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;p4est != NULL);</div>
<div class="line">  vtk = <a name="a6"></a><a class="code" href="p4est__vtk_8h.html#a34dbafa8dbc61172ead1a4da4c7103ca">p4est_vtk_context_new</a> (g-&gt;p4est, filename);</div>
<div class="line">  <a name="a7"></a><a class="code" href="p4est__vtk_8h.html#a78d37feae8abed0901541feab1247b87">p4est_vtk_context_set_geom</a> (vtk, g-&gt;geom);</div>
<div class="line">  <span class="keywordflow">if</span> ((rvtk = <a name="a8"></a><a class="code" href="p4est__vtk_8h.html#a17ce523f11f580944630c6c604a070da">p4est_vtk_write_header</a> (vtk)) == NULL) {</div>
<div class="line">    P4EST_GLOBAL_LERRORF (<span class="stringliteral">&quot;ERROR: write VTK header for %s\n&quot;</span>, filename);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line">  P4EST_ASSERT (rvtk == vtk);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* the cell data is written from a contiguous array of values */</span></div>
<div class="line">  <span class="keywordflow">if</span> ((rvtk = <a name="a9"></a><a class="code" href="p4est__vtk_8h.html#a737397caa2806babf0d501c03b918a23">p4est_vtk_write_cell_data</a> (vtk, 1, 1, 1, 0, 1, 0,</div>
<div class="line">                                         fnames, fvalues)) == NULL) {</div>
<div class="line">    P4EST_GLOBAL_LERRORF (<span class="stringliteral">&quot;ERROR: write VTK data for %s\n&quot;</span>, filename);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line">  P4EST_ASSERT (rvtk == vtk);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* finalize the output files and deallocate context */</span></div>
<div class="line">  <span class="keywordflow">if</span> (<a name="a10"></a><a class="code" href="p4est__vtk_8h.html#a23950ebd8b9b99877fa152752b5150d4">p4est_vtk_write_footer</a> (vtk)) {</div>
<div class="line">    P4EST_GLOBAL_LERRORF (<span class="stringliteral">&quot;ERROR: write VTK footer for %s\n&quot;</span>, filename);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* return success */</span></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/************ functions that expect user data internal to p4est **************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* callback to initialize internal quadrant data */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_init_internal (<a name="_a11"></a><a class="code" href="structp4est.html">p4est_t</a> *<a class="code" href="structp4est.html">p4est</a>,</div>
<div class="line">                        <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                        <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * quadrant)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* the global data structure is stashed into the forest&#39;s user pointer */</span></div>
<div class="line">  p4est_userdata_global_t *g =</div>
<div class="line">    (p4est_userdata_global_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a name="a12"></a><a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* p4est is agnostic to the quadrant user data */</span></div>
<div class="line">  userdata_quadrant_internal_t *qdat =</div>
<div class="line">    (userdata_quadrant_internal_t *) quadrant-&gt;<a name="a13"></a><a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a name="a14"></a><a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* compute field value from analytic expression */</span></div>
<div class="line">  qdat-&gt;value = userdata_value (g, which_tree, quadrant);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* we know that the callback is executed in order for every quadrant */</span></div>
<div class="line">  g-&gt;qcount++;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* callback for placing the element data in the VTK file */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_vtk_internal_volume (<a name="_a15"></a><a class="code" href="structp4est__iter__volume__info.html">p4est_iter_volume_info_t</a> *v, <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* the global data structure is passed by the iterator */</span></div>
<div class="line">  p4est_userdata_global_t *g = (p4est_userdata_global_t *) user_data;</div>
<div class="line">  userdata_quadrant_internal_t *qdat;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* check call consistency */</span></div>
<div class="line">  P4EST_ASSERT (v != NULL);</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (v-&gt;<a name="a16"></a>p4est == g-&gt;p4est);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray != NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* access quadrant user data */</span></div>
<div class="line">  qdat = (userdata_quadrant_internal_t *) v-&gt;<a name="a17"></a><a class="code" href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">quad</a>-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">  P4EST_ASSERT (qdat != NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write quadrant value into output array and advance counter */</span></div>
<div class="line">  *(<span class="keywordtype">double</span> *) sc_array_index (g-&gt;qarray, g-&gt;qcount) = qdat-&gt;value;</div>
<div class="line">  ++g-&gt;qcount;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* write a VTK file with the mesh and the element data */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_vtk_internal (p4est_userdata_global_t *g, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename)</div>
<div class="line">{</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;p4est != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray == NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;in_internal);</div>
<div class="line">  <span class="keywordflow">if</span> (g-&gt;novtk) {</div>
<div class="line">    <span class="comment">/* output disabled */</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* populate temporary array for output data */</span></div>
<div class="line">  g-&gt;qarray = sc_array_new_count (<span class="keyword">sizeof</span> (<span class="keywordtype">double</span>), (<span class="keywordtype">size_t</span>)</div>
<div class="line">                                  g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  userdata_iterate_volume (g, userdata_vtk_internal_volume);</div>
<div class="line">  <span class="keywordflow">if</span> (userdata_vtk_general (g, filename)) {</div>
<div class="line">    P4EST_GLOBAL_LERRORF (<span class="stringliteral">&quot;ERROR: write VTK file %s\n&quot;</span>, filename);</div>
<div class="line">    sc_array_destroy_null (&amp;g-&gt;qarray);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* return memory neutral */</span></div>
<div class="line">  sc_array_destroy_null (&amp;g-&gt;qarray);</div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* callback to tell p4est which quadrants shall be refined */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_refine_internal (<a class="code" href="structp4est.html">p4est_t</a> *<a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                          <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> *quadrant)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 refine;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* the global data structure is stashed into the forest&#39;s user pointer */</span></div>
<div class="line">  p4est_userdata_global_t *g =</div>
<div class="line">    (p4est_userdata_global_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* update the quadrant user data contents */</span></div>
<div class="line">  userdata_quadrant_internal_t *qdat =</div>
<div class="line">    (userdata_quadrant_internal_t *) quadrant-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">  P4EST_ASSERT (qdat != NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* placeholder for a proper refinement criterion */</span></div>
<div class="line">  refine = ((which_tree % 3) == 0) || (fabs (qdat-&gt;value) &gt; .8);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (!refine || quadrant-&gt;<a name="a18"></a><a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> &gt;= g-&gt;maxlevel) {</div>
<div class="line">    <span class="comment">/* quadrant is unchanged, keep counting */</span></div>
<div class="line">    g-&gt;qcount++;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">/* calculate new quadrant data in the replacement callback */</span></div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* callback to tell p4est which quadrants shall be coarsened */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_coarsen_internal (<a class="code" href="structp4est.html">p4est_t</a> *<a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                           <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> *quadrant[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 coarsen;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* the global data structure is stashed into the forest&#39;s user pointer */</span></div>
<div class="line">  p4est_userdata_global_t *g =</div>
<div class="line">    (p4est_userdata_global_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* we do not coarsen, we are only passed one quadrant */</span></div>
<div class="line">  if (quadrant[1] == NULL) {</div>
<div class="line">    ++g-&gt;qcount;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* really should determine proper coarsening criterion */</span></div>
<div class="line">  coarsen = ((which_tree % 3) == 1);</div>
<div class="line">  <span class="keywordflow">if</span> (!coarsen) {</div>
<div class="line">    <span class="comment">/* we decided not to coarsen this family of quadrants */</span></div>
<div class="line">    ++g-&gt;qcount;</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">/* calculate new quadrant data in the replacement callback */</span></div>
<div class="line">    <span class="keywordflow">return</span> 1;</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* update element data for a family of quadrants during adaptation */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_replace_internal (<a class="code" href="structp4est.html">p4est_t</a> *<a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                           <span class="keywordtype">int</span> num_outgoing, <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> *outgoing[],</div>
<div class="line">                           <span class="keywordtype">int</span> num_incoming, <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> *incoming[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 i;</div>
<div class="line">  <span class="keywordtype">double</span>              sum;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* the global data structure is stashed into the forest&#39;s user pointer */</span></div>
<div class="line">  p4est_userdata_global_t *g =</div>
<div class="line">    (p4est_userdata_global_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* check context invariant */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;in_balance || g-&gt;bcount == 0);</div>
<div class="line"> </div>
<div class="line">  <span class="keywordflow">if</span> (num_incoming &gt; 1) {</div>
<div class="line">    <span class="comment">/* we are refining */</span></div>
<div class="line">    P4EST_ASSERT (num_outgoing == 1);</div>
<div class="line">    P4EST_ASSERT (num_incoming == <a name="a19"></a><a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* access old (larger) quadrant&#39;s data */</span></div>
<div class="line">    userdata_quadrant_internal_t *qold =</div>
<div class="line">      (userdata_quadrant_internal_t *) outgoing[0]-&gt;p.user_data;</div>
<div class="line">    P4EST_ASSERT (qold != NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* determine offset for new quadrants&#39; indices */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!g-&gt;in_balance) {</div>
<div class="line">      <span class="comment">/* we rely on the iterator property of the refinement algorithm */</span></div>
<div class="line">      g-&gt;qcount += <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> {</div>
<div class="line">      <span class="comment">/* within 2:1 balance, we do not have an iterator property;</span></div>
<div class="line"><span class="comment">         determine the new index by accessing the outgoing quadrant */</span></div>
<div class="line">      g-&gt;bcount += <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a> - 1;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* access new (smaller) quadrants&#39; data */</span></div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; ++i) {</div>
<div class="line">      userdata_quadrant_internal_t *qnew =</div>
<div class="line">        (userdata_quadrant_internal_t *) incoming[i]-&gt;p.user_data;</div>
<div class="line">      P4EST_ASSERT (qnew != NULL);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">/* we just copy the old value into the refined elements */</span></div>
<div class="line">      qnew-&gt;value = qold-&gt;value;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    <span class="comment">/* we are coarsening */</span></div>
<div class="line">    P4EST_ASSERT (!g-&gt;in_balance);</div>
<div class="line">    P4EST_ASSERT (num_outgoing == <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>);</div>
<div class="line">    P4EST_ASSERT (num_incoming == 1);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* access new (larger) quadrant&#39;s data */</span></div>
<div class="line">    userdata_quadrant_internal_t *qnew =</div>
<div class="line">      (userdata_quadrant_internal_t *) incoming[0]-&gt;p.user_data;</div>
<div class="line">    P4EST_ASSERT (qnew != NULL);</div>
<div class="line">    g-&gt;qcount++;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* access old (smaller) quadrants&#39; data */</span></div>
<div class="line">    sum = 0.;</div>
<div class="line">    <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; ++i) {</div>
<div class="line">      userdata_quadrant_internal_t *qold =</div>
<div class="line">        (userdata_quadrant_internal_t *) outgoing[i]-&gt;p.user_data;</div>
<div class="line">      P4EST_ASSERT (qold != NULL);</div>
<div class="line"> </div>
<div class="line">      <span class="comment">/* just copy the old value into the refined elements */</span></div>
<div class="line">      sum += qold-&gt;value;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* we just overage the old values into the coarsened element */</span></div>
<div class="line">    qnew-&gt;value = sum * (1. / <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>);</div>
<div class="line">  }</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* provide function for consistent deallocation */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_run_internal_return (<span class="keywordtype">int</span> retval, p4est_userdata_global_t *g)</div>
<div class="line">{</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* clean up what has been allocated in the same function */</span></div>
<div class="line">  <span class="keywordflow">if</span> (g-&gt;p4est != NULL) {</div>
<div class="line">    <span class="comment">/* destroy forest */</span></div>
<div class="line">    <a name="a20"></a><a class="code" href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a> (g-&gt;p4est);</div>
<div class="line">    g-&gt;p4est = NULL;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> retval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* core demo with quadrant data stored internal to p4est */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_run_internal (p4est_userdata_global_t *g)</div>
<div class="line">{</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;p4est == NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;in_internal);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* this is the demo for userdata allocated by p4est and stored internally */</span></div>
<div class="line">  P4EST_GLOBAL_PRODUCTION (<a name="a21"></a><a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a></div>
<div class="line">                           <span class="stringliteral">&quot;_userdata: application data INTERNAL\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* create initial forest and populate quadrant data by callback */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == 0);</div>
<div class="line">  g-&gt;p4est = <a name="a22"></a><a class="code" href="p4est__extended_8h.html#ac11cf572e8ac72c4beb78465f98b63f3">p4est_new_ext</a></div>
<div class="line">    (g-&gt;mpicomm, g-&gt;conn, 0, SC_MAX (g-&gt;maxlevel - 1, 0), 1,</div>
<div class="line">     sizeof (userdata_quadrant_internal_t), userdata_init_internal, g);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  g-&gt;qcount = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* We like the invariant that after partitioning, partition-independent</span></div>
<div class="line"><span class="comment">     coarsening is always possible since every family of siblings is placed</span></div>
<div class="line"><span class="comment">     on a single process; this is not guaranteed by p4est_new_ext. */</span></div>
<div class="line">  <a name="a23"></a><a class="code" href="p4est_8h.html#a54c1f4e6bc35c181952371a8046523aa">p4est_partition</a> (g-&gt;p4est, 1, NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write VTK files to visualize geometry and data */</span></div>
<div class="line">  <span class="keywordflow">if</span> (userdata_vtk_internal (g, <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_userdata_internal_new&quot;</span>)) {</div>
<div class="line">    P4EST_GLOBAL_LERROR (<span class="stringliteral">&quot;ERROR: write VTK output after forest_new\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> userdata_run_internal_return (-1, g);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* refine the mesh adaptively and non-recursively */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == 0);</div>
<div class="line">  <a name="a24"></a><a class="code" href="p4est__extended_8h.html#aad32df9df3630b6bac05e7366a5f1e46">p4est_refine_ext</a> (g-&gt;p4est, 0, g-&gt;maxlevel, userdata_refine_internal,</div>
<div class="line">                    NULL, userdata_replace_internal);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  g-&gt;qcount = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* coarsen the mesh adaptively and non-recursively */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == 0);</div>
<div class="line">  <a name="a25"></a><a class="code" href="p4est__extended_8h.html#a06630b99f70cb85c73452640e8b4d54e">p4est_coarsen_ext</a> (g-&gt;p4est, 0, 1, userdata_coarsen_internal,</div>
<div class="line">                     NULL, userdata_replace_internal);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  g-&gt;qcount = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* execute 2:1 balance on the mesh */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == 0);</div>
<div class="line">  P4EST_ASSERT (g-&gt;bcount == 0);</div>
<div class="line">  P4EST_ASSERT (!g-&gt;in_balance);</div>
<div class="line">  g-&gt;in_balance = 1;</div>
<div class="line">  <a name="a26"></a><a class="code" href="p4est__extended_8h.html#a666a197be8d6d83c08cc14bfdc8565ed">p4est_balance_ext</a> (g-&gt;p4est, <a name="a27"></a><a class="code" href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552caa5bf35c11d90c02cb481e9edadb51bda7">P4EST_CONNECT_FULL</a>,</div>
<div class="line">                     NULL, userdata_replace_internal);</div>
<div class="line">  g-&gt;bcount = 0;</div>
<div class="line">  g-&gt;in_balance = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write VTK files to visualize geometry and data after adaptation */</span></div>
<div class="line">  <span class="keywordflow">if</span> (userdata_vtk_internal (g, <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_userdata_internal_adapt&quot;</span>)) {</div>
<div class="line">    P4EST_GLOBAL_LERROR (<span class="stringliteral">&quot;ERROR: write VTK output after adaptation\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> userdata_run_internal_return (-1, g);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* repartition the mesh and the quadrant data */</span></div>
<div class="line">  <a class="code" href="p4est_8h.html#a54c1f4e6bc35c181952371a8046523aa">p4est_partition</a> (g-&gt;p4est, 1, NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write VTK files to visualize geometry and data after partitioning */</span></div>
<div class="line">  <span class="keywordflow">if</span> (userdata_vtk_internal (g, <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_userdata_internal_partition&quot;</span>)) {</div>
<div class="line">    P4EST_GLOBAL_LERROR (<span class="stringliteral">&quot;ERROR: write VTK output after adaptation\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> userdata_run_internal_return (-1, g);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* return memory neutral */</span></div>
<div class="line">  <span class="keywordflow">return</span> userdata_run_internal_return (0, g);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/************ functions that expect user data external to p4est **************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* metadata for each quadrant */</span></div>
<div class="line"><span class="keyword">typedef</span> <span class="keyword">struct </span>userdata_quadrant_external</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* refinement flag */</span></div>
<div class="line">  int8_t              refine;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* coarsening flag */</span></div>
<div class="line">  int8_t              coarsen;</div>
<div class="line">}</div>
<div class="line">userdata_quadrant_external_t;</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* callback to initialize quadrant metadata */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_init_external (<a class="code" href="structp4est.html">p4est_t</a> *<a class="code" href="structp4est.html">p4est</a>,</div>
<div class="line">                        <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                        <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> * quadrant)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* the global data structure is stashed into the forest&#39;s user pointer */</span></div>
<div class="line">  p4est_userdata_global_t *g =</div>
<div class="line">    (p4est_userdata_global_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* p4est is agnostic to the quadrant user data */</span></div>
<div class="line">  userdata_quadrant_external_t *qdat =</div>
<div class="line">    (userdata_quadrant_external_t *) quadrant-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* zero all bytes to initialize compiler padding */</span></div>
<div class="line">  memset (qdat, 0, <span class="keyword">sizeof</span> (*qdat));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* advance debug counter */</span></div>
<div class="line">  ++g-&gt;qcount;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* callback for local elements&#39; initialization */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_init_external_volume (<a class="code" href="structp4est__iter__volume__info.html">p4est_iter_volume_info_t</a> *v, <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* the global data structure is passed into every iterator */</span></div>
<div class="line">  p4est_userdata_global_t *g = (p4est_userdata_global_t *) user_data;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* check call consistency */</span></div>
<div class="line">  P4EST_ASSERT (v != NULL);</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (v-&gt;p4est == g-&gt;p4est);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* compute value in external userdata array */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray != NULL);</div>
<div class="line">  *(<span class="keywordtype">double</span> *) sc_array_index (g-&gt;qarray, g-&gt;qcount++) =</div>
<div class="line">    userdata_value (g, v-&gt;<a name="a28"></a><a class="code" href="structp4est__iter__volume__info.html#aa9203b989bb29cc3ff536dd224727ab4">treeid</a>, v-&gt;<a class="code" href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">quad</a>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* write a VTK file with the mesh and the element data */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_vtk_external (p4est_userdata_global_t *g, <span class="keyword">const</span> <span class="keywordtype">char</span> *filename)</div>
<div class="line">{</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;p4est != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;in_external);</div>
<div class="line">  <span class="keywordflow">if</span> (g-&gt;novtk) {</div>
<div class="line">    <span class="comment">/* output disabled */</span></div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* the data array is already in the required form */</span></div>
<div class="line">  <span class="keywordflow">if</span> (userdata_vtk_general (g, filename)) {</div>
<div class="line">    P4EST_GLOBAL_LERRORF (<span class="stringliteral">&quot;ERROR: write VTK file %s\n&quot;</span>, filename);</div>
<div class="line">    <span class="keywordflow">return</span> -1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* return success */</span></div>
<div class="line">  <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* callback to evaluate refinement/coarsening criterio */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_criterion_external_volume (<a class="code" href="structp4est__iter__volume__info.html">p4est_iter_volume_info_t</a> *v,</div>
<div class="line">                                    <span class="keywordtype">void</span> *user_data)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* the global data structure is passed into every iterator */</span></div>
<div class="line">  p4est_userdata_global_t *g = (p4est_userdata_global_t *) user_data;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* check call consistency */</span></div>
<div class="line">  P4EST_ASSERT (v != NULL);</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (v-&gt;p4est == g-&gt;p4est);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* p4est is agnostic to the quadrant user data */</span></div>
<div class="line">  userdata_quadrant_external_t *qdat =</div>
<div class="line">    (userdata_quadrant_external_t *) v-&gt;<a class="code" href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">quad</a>-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* refinement criteria for demonstration */</span></div>
<div class="line">  qdat-&gt;refine = ((v-&gt;<a class="code" href="structp4est__iter__volume__info.html#aa9203b989bb29cc3ff536dd224727ab4">treeid</a> % 3) == 0);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* coarsening criteria for demonstration */</span></div>
<div class="line">  qdat-&gt;coarsen = ((v-&gt;<a class="code" href="structp4est__iter__volume__info.html#aa9203b989bb29cc3ff536dd224727ab4">treeid</a> % 3) == 1);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* refine also if value is near the extremes */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray != NULL);</div>
<div class="line">  <span class="keywordflow">if</span> (fabs (*(<span class="keywordtype">double</span> *) sc_array_index (g-&gt;qarray, g-&gt;qcount++)) &gt; .8) {</div>
<div class="line">    qdat-&gt;refine = 1;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* at this point, refinement and coarsening may both be requested */</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* callback to tell p4est which quadrants shall be refined */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_refine_external (<a class="code" href="structp4est.html">p4est_t</a> *<a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                          <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> *quadrant)</div>
<div class="line">{</div>
<div class="line">  <span class="comment">/* the global data structure is stashed into the forest&#39;s user pointer */</span></div>
<div class="line">  p4est_userdata_global_t *g =</div>
<div class="line">    (p4est_userdata_global_t *) <a class="code" href="structp4est.html">p4est</a>-&gt;<a class="code" href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">user_pointer</a>;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* access the quadrant user data contents */</span></div>
<div class="line">  userdata_quadrant_external_t *qdat =</div>
<div class="line">    (userdata_quadrant_external_t *) quadrant-&gt;<a class="code" href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p</a>.<a class="code" href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">user_data</a>;</div>
<div class="line">  P4EST_ASSERT (qdat != NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* access refinement criterion */</span></div>
<div class="line">  <span class="keywordflow">if</span> (!qdat-&gt;refine || quadrant-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> &gt;= g-&gt;maxlevel) {</div>
<div class="line">    <span class="keywordflow">return</span> 0;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* callback to tell p4est which quadrants shall be coarsened */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_coarsen_external (<a class="code" href="structp4est.html">p4est_t</a> *<a class="code" href="structp4est.html">p4est</a>, <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a> which_tree,</div>
<div class="line">                           <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a> *quadrant[])</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 i;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* with external user data, we do not use p4est_coarsen_ext */</span></div>
<div class="line">  P4EST_ASSERT (quadrant[1] != NULL);</div>
<div class="line">  <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; ++i) {</div>
<div class="line">    <span class="comment">/* access the quadrant user data contents */</span></div>
<div class="line">    userdata_quadrant_external_t *qdat =</div>
<div class="line">      (userdata_quadrant_external_t *) quadrant[i]-&gt;p.user_data;</div>
<div class="line">    P4EST_ASSERT (qdat != NULL);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* access coarsening criterion */</span></div>
<div class="line">    <span class="keywordflow">if</span> (!qdat-&gt;coarsen || qdat-&gt;refine) {</div>
<div class="line">      <span class="keywordflow">return</span> 0;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> 1;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* interpolate/project data after refinement/ */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_project_external (p4est_userdata_global_t *g)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 i;</div>
<div class="line">  <span class="keywordtype">double</span>              value;</div>
<div class="line">  <span class="keywordtype">size_t</span>              pdindex, ndindex;</div>
<div class="line">  <span class="keywordtype">size_t</span>              pdbound;</div>
<div class="line"><span class="preprocessor">#ifdef P4EST_ENABLE_DEBUG</span></div>
<div class="line">  <span class="keywordtype">size_t</span>              ndbound;</div>
<div class="line"><span class="preprocessor">#endif</span></div>
<div class="line">  sc_array_t         *parray, *narray;</div>
<div class="line">  <a class="code" href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a>      tt;</div>
<div class="line">  <a name="_a29"></a><a class="code" href="structp4est__tree.html">p4est_tree_t</a>       *ptree, *ntree;</div>
<div class="line">  <a class="code" href="structp4est__quadrant.html">p4est_quadrant_t</a>   *pquad, *nquad;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* check invariants */</span></div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;p4est != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;n4est != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;in_external);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* allocate a second data array and deallocate the first afterwards */</span></div>
<div class="line">  pdindex = ndindex = 0;</div>
<div class="line">  parray = g-&gt;qarray;</div>
<div class="line">  P4EST_ASSERT (parray-&gt;elem_count == (<span class="keywordtype">size_t</span>) g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  narray = sc_array_new_count (<span class="keyword">sizeof</span> (<span class="keywordtype">double</span>),</div>
<div class="line">                               (<span class="keywordtype">size_t</span>) g-&gt;n4est-&gt;local_num_quadrants);</div>
<div class="line">  P4EST_ASSERT (g-&gt;p4est-&gt;first_local_tree == g-&gt;n4est-&gt;first_local_tree);</div>
<div class="line">  P4EST_ASSERT (g-&gt;p4est-&gt;last_local_tree == g-&gt;n4est-&gt;last_local_tree);</div>
<div class="line">  <span class="keywordflow">for</span> (tt = g-&gt;n4est-&gt;first_local_tree; tt &lt;= g-&gt;n4est-&gt;last_local_tree; ++tt) {</div>
<div class="line">    <span class="comment">/* simultaneous loop over old and new mesh with same partition */</span></div>
<div class="line">    ptree = p4est_tree_array_index (g-&gt;p4est-&gt;trees, tt);</div>
<div class="line">    pquad = p4est_quadrant_array_index (&amp;ptree-&gt;<a name="a30"></a><a class="code" href="structp4est__tree.html#aa17e5be92cc11b1f53f31a8174c19345">quadrants</a>, 0);</div>
<div class="line">    pdbound = (size_t) ptree-&gt;<a name="a31"></a><a class="code" href="structp4est__tree.html#ab0248e174f0d63c76bbe1ba955f732be">quadrants_offset</a> + ptree-&gt;<a class="code" href="structp4est__tree.html#aa17e5be92cc11b1f53f31a8174c19345">quadrants</a>.elem_count;</div>
<div class="line">    ntree = p4est_tree_array_index (g-&gt;n4est-&gt;trees, tt);</div>
<div class="line">    nquad = p4est_quadrant_array_index (&amp;ntree-&gt;<a class="code" href="structp4est__tree.html#aa17e5be92cc11b1f53f31a8174c19345">quadrants</a>, 0);</div>
<div class="line"><span class="preprocessor">#ifdef P4EST_ENABLE_DEBUG</span></div>
<div class="line">    ndbound = (size_t) ntree-&gt;<a class="code" href="structp4est__tree.html#ab0248e174f0d63c76bbe1ba955f732be">quadrants_offset</a> + ntree-&gt;<a class="code" href="structp4est__tree.html#aa17e5be92cc11b1f53f31a8174c19345">quadrants</a>.elem_count;</div>
<div class="line">#endif</div>
<div class="line">    for (;;) {</div>
<div class="line">      <span class="comment">/* simultaneous loop over old and new quadrants in this tree */</span></div>
<div class="line">      P4EST_ASSERT (abs (pquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> - nquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) &lt;= 1);</div>
<div class="line">      <span class="keywordflow">if</span> (pquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> == nquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) {</div>
<div class="line">        <span class="comment">/* old and new quadrant are same size: copy value */</span></div>
<div class="line">        *(<span class="keywordtype">double</span> *) sc_array_index (narray, ndindex++) =</div>
<div class="line">          *(<span class="keywordtype">double</span> *) sc_array_index (parray, pdindex++);</div>
<div class="line">        pquad++;</div>
<div class="line">        nquad++;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (pquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> + 1 == nquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) {</div>
<div class="line">        <span class="comment">/* new quadrants are refined from the old one: copy value */</span></div>
<div class="line">        value = *(<span class="keywordtype">double</span> *) sc_array_index (parray, pdindex++);</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; ++i) {</div>
<div class="line">          <span class="comment">/* all new quadrants must be siblings of a family */</span></div>
<div class="line">          *(<span class="keywordtype">double</span> *) sc_array_index (narray, ndindex++) = value;</div>
<div class="line">          P4EST_ASSERT (<a name="a32"></a><a class="code" href="p4est__bits_8h.html#a2b0cbbd87c0bc9d640fb0ee8b32d9a0f">p4est_quadrant_child_id</a> (nquad) == i);</div>
<div class="line">          P4EST_ASSERT (nquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> == pquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> + 1);</div>
<div class="line">          ++nquad;</div>
<div class="line">        }</div>
<div class="line">        ++pquad;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (nquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> + 1 == pquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a>) {</div>
<div class="line">        <span class="comment">/* new quadrant is coarsened from the old ones */</span></div>
<div class="line">        value = 0.;</div>
<div class="line">        <span class="keywordflow">for</span> (i = 0; i &lt; <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>; ++i) {</div>
<div class="line">          <span class="comment">/* all old quadrants must be siblings of a family */</span></div>
<div class="line">          value += *(<span class="keywordtype">double</span> *) sc_array_index (parray, pdindex++);</div>
<div class="line">          P4EST_ASSERT (<a class="code" href="p4est__bits_8h.html#a2b0cbbd87c0bc9d640fb0ee8b32d9a0f">p4est_quadrant_child_id</a> (pquad) == i);</div>
<div class="line">          P4EST_ASSERT (pquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> == nquad-&gt;<a class="code" href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">level</a> + 1);</div>
<div class="line">          ++pquad;</div>
<div class="line">        }</div>
<div class="line">        <span class="comment">/* for demonstration just compute the average value */</span></div>
<div class="line">        *(<span class="keywordtype">double</span> *) sc_array_index (narray, ndindex++) =</div>
<div class="line">          value * (1. / <a class="code" href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a>);</div>
<div class="line">        ++nquad;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span> {</div>
<div class="line">        <span class="comment">/* no other situation can arise */</span></div>
<div class="line">        SC_ABORT_NOT_REACHED ();</div>
<div class="line">      }</div>
<div class="line"> </div>
<div class="line">      <span class="comment">/* break quadrant loop if the local tree is traversed */</span></div>
<div class="line">      <span class="keywordflow">if</span> (pdindex == pdbound) {</div>
<div class="line">        P4EST_ASSERT (ndindex == ndbound);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      P4EST_ASSERT (ndindex &lt; ndbound);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* this tree is now processed */</span></div>
<div class="line">    P4EST_ASSERT (pquad - p4est_quadrant_array_index (&amp;ptree-&gt;<a class="code" href="structp4est__tree.html#aa17e5be92cc11b1f53f31a8174c19345">quadrants</a>, 0) ==</div>
<div class="line">                  (ptrdiff_t) ptree-&gt;<a class="code" href="structp4est__tree.html#aa17e5be92cc11b1f53f31a8174c19345">quadrants</a>.elem_count);</div>
<div class="line">    P4EST_ASSERT (nquad - p4est_quadrant_array_index (&amp;ntree-&gt;<a class="code" href="structp4est__tree.html#aa17e5be92cc11b1f53f31a8174c19345">quadrants</a>, 0) ==</div>
<div class="line">                  (ptrdiff_t) ntree-&gt;<a class="code" href="structp4est__tree.html#aa17e5be92cc11b1f53f31a8174c19345">quadrants</a>.elem_count);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* by construction we have traversed both meshes simultaneously */</span></div>
<div class="line">  P4EST_ASSERT (pdindex == (<span class="keywordtype">size_t</span>) g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  P4EST_ASSERT (ndindex == (<span class="keywordtype">size_t</span>) g-&gt;n4est-&gt;local_num_quadrants);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* replace the old array with the new one */</span></div>
<div class="line">  sc_array_destroy (g-&gt;qarray);</div>
<div class="line">  g-&gt;qarray = narray;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* adapt the mesh according to refinement criteria and project application data */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_adapt_external (p4est_userdata_global_t *g)</div>
<div class="line">{</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;in_external);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* execute refinement on a copy of the forest */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;n4est == NULL);</div>
<div class="line">  g-&gt;n4est = <a name="a33"></a><a class="code" href="p4est_8h.html#a808053321e785b3aba01aaa63f68517d">p4est_copy</a> (g-&gt;p4est, 1);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* adapt the new forest non-recursively */</span></div>
<div class="line">  <a name="a34"></a><a class="code" href="p4est_8h.html#a1a31375edfa42b5609e7656233c32cca">p4est_refine</a> (g-&gt;n4est, 0,</div>
<div class="line">                userdata_refine_external, userdata_init_external);</div>
<div class="line">  <a name="a35"></a><a class="code" href="p4est_8h.html#ad250f4765d9778ec3940e9fabea7c853">p4est_coarsen</a> (g-&gt;n4est, 0,</div>
<div class="line">                 userdata_coarsen_external, userdata_init_external);</div>
<div class="line">  <a name="a36"></a><a class="code" href="p4est_8h.html#a6b603736cf5007b14755197a9c179a85">p4est_balance</a> (g-&gt;n4est, <a class="code" href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552caa5bf35c11d90c02cb481e9edadb51bda7">P4EST_CONNECT_FULL</a>, userdata_init_external);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* interpolate/project values from old to adapted forest */</span></div>
<div class="line">  userdata_project_external (g);</div>
<div class="line">  <a class="code" href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a> (g-&gt;p4est);</div>
<div class="line">  g-&gt;p4est = g-&gt;n4est;</div>
<div class="line">  g-&gt;n4est = NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* execute partitioning with associated data transfer */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span></div>
<div class="line">userdata_partition_external (p4est_userdata_global_t *g)</div>
<div class="line">{</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;n4est == NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;in_external);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* partition moves the quadrant user data around */</span></div>
<div class="line">  g-&gt;n4est = <a class="code" href="p4est_8h.html#a808053321e785b3aba01aaa63f68517d">p4est_copy</a> (g-&gt;p4est, 1);</div>
<div class="line">  <span class="keywordflow">if</span> (<a name="a37"></a><a class="code" href="p4est__extended_8h.html#a124f2669c375fa66dc746be591ca2404">p4est_partition_ext</a> (g-&gt;n4est, 1, NULL) == 0) {</div>
<div class="line">    <span class="comment">/* the partition is unchanged, do nothing */</span></div>
<div class="line">    P4EST_ASSERT (g-&gt;p4est-&gt;local_num_quadrants ==</div>
<div class="line">                  g-&gt;n4est-&gt;local_num_quadrants);</div>
<div class="line">    <a class="code" href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a> (g-&gt;n4est);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">else</span> {</div>
<div class="line">    sc_array_t         *parray, *narray;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* transfer quadrant data from old to new partition */</span></div>
<div class="line">    parray = g-&gt;qarray;</div>
<div class="line">    P4EST_ASSERT (parray-&gt;elem_count ==</div>
<div class="line">                  (<span class="keywordtype">size_t</span>) g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">    narray = sc_array_new_count (<span class="keyword">sizeof</span> (<span class="keywordtype">double</span>),</div>
<div class="line">                                 (<span class="keywordtype">size_t</span>) g-&gt;n4est-&gt;local_num_quadrants);</div>
<div class="line">    <a name="a38"></a><a class="code" href="p4est__communication_8h.html#a9a9ef6c16f81067f0c917a838a8fdfac">p4est_transfer_fixed</a> (g-&gt;n4est-&gt;global_first_quadrant,</div>
<div class="line">                          g-&gt;p4est-&gt;global_first_quadrant,</div>
<div class="line">                          <span class="comment">/* the tag can really be anything */</span></div>
<div class="line">                          g-&gt;p4est-&gt;mpicomm, P4EST_COMM_TAG_LAST + 0,</div>
<div class="line">                          <span class="comment">/* don&#39;t assert invalid index on empty array */</span></div>
<div class="line">                          sc_array_index_null (narray, 0),</div>
<div class="line">                          sc_array_index_null (parray, 0), parray-&gt;elem_size);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">/* free old forest and application data */</span></div>
<div class="line">    sc_array_destroy (g-&gt;qarray);</div>
<div class="line">    g-&gt;qarray = narray;</div>
<div class="line">    <a class="code" href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a> (g-&gt;p4est);</div>
<div class="line">    g-&gt;p4est = g-&gt;n4est;</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* maintain invariant */</span></div>
<div class="line">  g-&gt;n4est = NULL;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* provide function for consistent deallocation */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_run_external_return (<span class="keywordtype">int</span> retval, p4est_userdata_global_t *g)</div>
<div class="line">{</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* clean up what has been allocated in the same function */</span></div>
<div class="line">  <span class="keywordflow">if</span> (g-&gt;qarray != NULL) {</div>
<div class="line">    <span class="comment">/* destroy application userdata */</span></div>
<div class="line">    sc_array_destroy_null (&amp;g-&gt;qarray);</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (g-&gt;n4est != NULL) {</div>
<div class="line">    <span class="comment">/* destroy forest */</span></div>
<div class="line">    <a class="code" href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a> (g-&gt;n4est);</div>
<div class="line">    g-&gt;n4est = NULL;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">if</span> (g-&gt;p4est != NULL) {</div>
<div class="line">    <span class="comment">/* destroy forest */</span></div>
<div class="line">    <a class="code" href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a> (g-&gt;p4est);</div>
<div class="line">    g-&gt;p4est = NULL;</div>
<div class="line">  }</div>
<div class="line">  <span class="keywordflow">return</span> retval;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* core demo with quadrant data stored external to p4est */</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">int</span></div>
<div class="line">userdata_run_external (p4est_userdata_global_t *g)</div>
<div class="line">{</div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;p4est == NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray == NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;in_external);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* this is the demo for userdata allocated by the application developer */</span></div>
<div class="line">  P4EST_GLOBAL_PRODUCTION (<a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a></div>
<div class="line">                           <span class="stringliteral">&quot;_userdata: application data EXTERNAL\n&quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* create initial forest and populate metadata by callback */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == 0);</div>
<div class="line">  g-&gt;p4est = <a class="code" href="p4est__extended_8h.html#ac11cf572e8ac72c4beb78465f98b63f3">p4est_new_ext</a></div>
<div class="line">    (g-&gt;mpicomm, g-&gt;conn, 0, SC_MAX (g-&gt;maxlevel - 1, 0), 1,</div>
<div class="line">     sizeof (userdata_quadrant_external_t), userdata_init_external, g);</div>
<div class="line">  P4EST_ASSERT (g-&gt;qcount == g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  g-&gt;qcount = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* We like the invariant that after partitioning, partition-independent</span></div>
<div class="line"><span class="comment">     coarsening is always possible since every family of siblings is placed</span></div>
<div class="line"><span class="comment">     on a single process; this is not guaranteed by p4est_new_ext. */</span></div>
<div class="line">  <a class="code" href="p4est_8h.html#a54c1f4e6bc35c181952371a8046523aa">p4est_partition</a> (g-&gt;p4est, 1, NULL);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* populate quadrant data by volume iterator */</span></div>
<div class="line">  P4EST_ASSERT (g-&gt;qarray == NULL);</div>
<div class="line">  g-&gt;qarray = sc_array_new_count (<span class="keyword">sizeof</span> (<span class="keywordtype">double</span>),</div>
<div class="line">                                  (<span class="keywordtype">size_t</span>) g-&gt;p4est-&gt;local_num_quadrants);</div>
<div class="line">  userdata_iterate_volume (g, userdata_init_external_volume);</div>
<div class="line">  g-&gt;qcount = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write VTK files to visualize geometry and data */</span></div>
<div class="line">  <span class="keywordflow">if</span> (userdata_vtk_external (g, <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_userdata_external_new&quot;</span>)) {</div>
<div class="line">    P4EST_GLOBAL_LERROR (<span class="stringliteral">&quot;ERROR: write VTK output after forest_new\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> userdata_run_external_return (-1, g);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* evaluate refinement criteria */</span></div>
<div class="line">  userdata_iterate_volume (g, userdata_criterion_external_volume);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* refine, coarsen, and balance the mesh, then project data once */</span></div>
<div class="line">  userdata_adapt_external (g);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write VTK files to visualize geometry and data */</span></div>
<div class="line">  <span class="keywordflow">if</span> (userdata_vtk_external (g, <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_userdata_external_adapt&quot;</span>)) {</div>
<div class="line">    P4EST_GLOBAL_LERROR (<span class="stringliteral">&quot;ERROR: write VTK output after forest_adapt\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> userdata_run_external_return (-1, g);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* repartition the mesh and the application data */</span></div>
<div class="line">  userdata_partition_external (g);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* write VTK files to visualize geometry and data */</span></div>
<div class="line">  <span class="keywordflow">if</span> (userdata_vtk_external (g, <a class="code" href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a> <span class="stringliteral">&quot;_userdata_external_partition&quot;</span>)) {</div>
<div class="line">    P4EST_GLOBAL_LERROR (<span class="stringliteral">&quot;ERROR: write VTK output after forest_partition\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> userdata_run_external_return (-1, g);</div>
<div class="line">  }</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* return memory neutral */</span></div>
<div class="line">  <span class="keywordflow">return</span> userdata_run_external_return (0, g);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">/* *********** this function is the entry point into this file ***************/</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">/* execute the demonstration */</span></div>
<div class="line"><span class="keywordtype">int</span></div>
<div class="line">p4est_userdata_run (p4est_userdata_global_t *g)</div>
<div class="line">{</div>
<div class="line">  <span class="keywordtype">int</span>                 erres;</div>
<div class="line"> </div>
<div class="line">  P4EST_ASSERT (g != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;options != NULL);</div>
<div class="line">  P4EST_ASSERT (g-&gt;conn != NULL);</div>
<div class="line">  P4EST_ASSERT (<a name="a39"></a><a class="code" href="p4est__connectivity_8h.html#a3780b75fcd2a5b578c6dc294c4e77a5e">p4est_connectivity_is_valid</a> (g-&gt;conn));</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* for consistency, track error status the same way */</span></div>
<div class="line">  P4EST_ASSERT (!g-&gt;in_internal);</div>
<div class="line">  P4EST_ASSERT (!g-&gt;in_external);</div>
<div class="line">  erres = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* run the example once with p4est-allocated application data */</span></div>
<div class="line">  g-&gt;in_internal = 1;</div>
<div class="line">  <span class="keywordflow">if</span> (!erres &amp;&amp; !g-&gt;noint &amp;&amp; (erres = userdata_run_internal (g))) {</div>
<div class="line">    P4EST_GLOBAL_LERROR (<span class="stringliteral">&quot;ERROR: run with internal data\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  g-&gt;in_internal = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* run the example another time with user-allocated application data */</span></div>
<div class="line">  g-&gt;in_external = 1;</div>
<div class="line">  <span class="keywordflow">if</span> (!erres &amp;&amp; !g-&gt;noext &amp;&amp; (erres = userdata_run_external (g))) {</div>
<div class="line">    P4EST_GLOBAL_LERROR (<span class="stringliteral">&quot;ERROR: run with external data\n&quot;</span>);</div>
<div class="line">  }</div>
<div class="line">  g-&gt;in_external = 0;</div>
<div class="line"> </div>
<div class="line">  <span class="comment">/* return error status */</span></div>
<div class="line">  P4EST_ASSERT (!g-&gt;in_internal);</div>
<div class="line">  P4EST_ASSERT (!g-&gt;in_external);</div>
<div class="line">  <span class="keywordflow">return</span> erres;</div>
<div class="line">}</div>
<div class="ttc" id="ap4est_8h_html_a1a31375edfa42b5609e7656233c32cca"><div class="ttname"><a href="p4est_8h.html#a1a31375edfa42b5609e7656233c32cca">p4est_refine</a></div><div class="ttdeci">void p4est_refine(p4est_t *p4est, int refine_recursive, p4est_refine_t refine_fn, p4est_init_t init_fn)</div><div class="ttdoc">Refine a forest.</div></div>
<div class="ttc" id="ap4est_8h_html_a1e78f347378fe8b097ef019214f2338e"><div class="ttname"><a href="p4est_8h.html#a1e78f347378fe8b097ef019214f2338e">p4est_destroy</a></div><div class="ttdeci">void p4est_destroy(p4est_t *p4est)</div><div class="ttdoc">Destroy a p4est.</div></div>
<div class="ttc" id="ap4est_8h_html_a54c1f4e6bc35c181952371a8046523aa"><div class="ttname"><a href="p4est_8h.html#a54c1f4e6bc35c181952371a8046523aa">p4est_partition</a></div><div class="ttdeci">void p4est_partition(p4est_t *p4est, int allow_for_coarsening, p4est_weight_t weight_fn)</div><div class="ttdoc">Equally partition the forest.</div></div>
<div class="ttc" id="ap4est_8h_html_a6b603736cf5007b14755197a9c179a85"><div class="ttname"><a href="p4est_8h.html#a6b603736cf5007b14755197a9c179a85">p4est_balance</a></div><div class="ttdeci">void p4est_balance(p4est_t *p4est, p4est_connect_type_t btype, p4est_init_t init_fn)</div><div class="ttdoc">2:1 balance the size differences of neighboring elements in a forest.</div></div>
<div class="ttc" id="ap4est_8h_html_a808053321e785b3aba01aaa63f68517d"><div class="ttname"><a href="p4est_8h.html#a808053321e785b3aba01aaa63f68517d">p4est_copy</a></div><div class="ttdeci">p4est_t * p4est_copy(p4est_t *input, int copy_data)</div><div class="ttdoc">Make a deep copy of a p4est.</div></div>
<div class="ttc" id="ap4est_8h_html_ad250f4765d9778ec3940e9fabea7c853"><div class="ttname"><a href="p4est_8h.html#ad250f4765d9778ec3940e9fabea7c853">p4est_coarsen</a></div><div class="ttdeci">void p4est_coarsen(p4est_t *p4est, int coarsen_recursive, p4est_coarsen_t coarsen_fn, p4est_init_t init_fn)</div><div class="ttdoc">Coarsen a forest.</div></div>
<div class="ttc" id="ap4est__base_8h_html_a05ea8ceb664ae2403fbcf7b1dcc70ea0"><div class="ttname"><a href="p4est__base_8h.html#a05ea8ceb664ae2403fbcf7b1dcc70ea0">p4est_qcoord_t</a></div><div class="ttdeci">int32_t p4est_qcoord_t</div><div class="ttdoc">Typedef for quadrant coordinates.</div><div class="ttdef"><b>Definition:</b> p4est_base.h:81</div></div>
<div class="ttc" id="ap4est__base_8h_html_a8e849f705b0d4d1702b8f5102823f48c"><div class="ttname"><a href="p4est__base_8h.html#a8e849f705b0d4d1702b8f5102823f48c">p4est_topidx_t</a></div><div class="ttdeci">int32_t p4est_topidx_t</div><div class="ttdoc">Typedef for counting topological entities (trees, tree vertices).</div><div class="ttdef"><b>Definition:</b> p4est_base.h:93</div></div>
<div class="ttc" id="ap4est__bits_8h_html"><div class="ttname"><a href="p4est__bits_8h.html">p4est_bits.h</a></div><div class="ttdoc">Routines for manipulating quadrants (neighbors, parents, children, etc.)</div></div>
<div class="ttc" id="ap4est__bits_8h_html_a1c0bd87bc88f3389fa5f224922ce060a"><div class="ttname"><a href="p4est__bits_8h.html#a1c0bd87bc88f3389fa5f224922ce060a">p4est_quadrant_volume_coordinates</a></div><div class="ttdeci">void p4est_quadrant_volume_coordinates(const p4est_quadrant_t *q, p4est_qcoord_t coords[])</div><div class="ttdoc">Compute the coordinates of a quadrant's midpoint.</div></div>
<div class="ttc" id="ap4est__bits_8h_html_a2b0cbbd87c0bc9d640fb0ee8b32d9a0f"><div class="ttname"><a href="p4est__bits_8h.html#a2b0cbbd87c0bc9d640fb0ee8b32d9a0f">p4est_quadrant_child_id</a></div><div class="ttdeci">int p4est_quadrant_child_id(const p4est_quadrant_t *q)</div><div class="ttdoc">Compute the position of this child within its siblings.</div></div>
<div class="ttc" id="ap4est__communication_8h_html"><div class="ttname"><a href="p4est__communication_8h.html">p4est_communication.h</a></div><div class="ttdoc">Parallel messaging and support code.</div></div>
<div class="ttc" id="ap4est__communication_8h_html_a9a9ef6c16f81067f0c917a838a8fdfac"><div class="ttname"><a href="p4est__communication_8h.html#a9a9ef6c16f81067f0c917a838a8fdfac">p4est_transfer_fixed</a></div><div class="ttdeci">void p4est_transfer_fixed(const p4est_gloidx_t *dest_gfq, const p4est_gloidx_t *src_gfq, sc_MPI_Comm mpicomm, int tag, void *dest_data, const void *src_data, size_t data_size)</div><div class="ttdoc">Transfer data associated with one forest partition to another.</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_a2c4786e65053166a16b7afb2711d35cb"><div class="ttname"><a href="p4est__connectivity_8h.html#a2c4786e65053166a16b7afb2711d35cb">P4EST_DIM</a></div><div class="ttdeci">#define P4EST_DIM</div><div class="ttdoc">The spatial dimension.</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:71</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_a3780b75fcd2a5b578c6dc294c4e77a5e"><div class="ttname"><a href="p4est__connectivity_8h.html#a3780b75fcd2a5b578c6dc294c4e77a5e">p4est_connectivity_is_valid</a></div><div class="ttdeci">int p4est_connectivity_is_valid(p4est_connectivity_t *connectivity)</div><div class="ttdoc">Examine a connectivity structure.</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_ab6dcdaf6247909a4bf21a817391781a8"><div class="ttname"><a href="p4est__connectivity_8h.html#ab6dcdaf6247909a4bf21a817391781a8">P4EST_STRING</a></div><div class="ttdeci">#define P4EST_STRING</div><div class="ttdoc">p4est identification string</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:94</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_acb49ce9f7b688a2c6b6d62bda9ff5555"><div class="ttname"><a href="p4est__connectivity_8h.html#acb49ce9f7b688a2c6b6d62bda9ff5555">P4EST_CHILDREN</a></div><div class="ttdeci">#define P4EST_CHILDREN</div><div class="ttdoc">The number of children of a quadrant, also the number of corners.</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:75</div></div>
<div class="ttc" id="ap4est__connectivity_8h_html_adc5f6166fc408c325589ce3e620552caa5bf35c11d90c02cb481e9edadb51bda7"><div class="ttname"><a href="p4est__connectivity_8h.html#adc5f6166fc408c325589ce3e620552caa5bf35c11d90c02cb481e9edadb51bda7">P4EST_CONNECT_FULL</a></div><div class="ttdeci">@ P4EST_CONNECT_FULL</div><div class="ttdoc">= CORNER.</div><div class="ttdef"><b>Definition:</b> p4est_connectivity.h:119</div></div>
<div class="ttc" id="ap4est__extended_8h_html"><div class="ttname"><a href="p4est__extended_8h.html">p4est_extended.h</a></div><div class="ttdoc">Interface routines with extended capabilities.</div></div>
<div class="ttc" id="ap4est__extended_8h_html_a06630b99f70cb85c73452640e8b4d54e"><div class="ttname"><a href="p4est__extended_8h.html#a06630b99f70cb85c73452640e8b4d54e">p4est_coarsen_ext</a></div><div class="ttdeci">void p4est_coarsen_ext(p4est_t *p4est, int coarsen_recursive, int callback_orphans, p4est_coarsen_t coarsen_fn, p4est_init_t init_fn, p4est_replace_t replace_fn)</div><div class="ttdoc">Coarsen a forest.</div></div>
<div class="ttc" id="ap4est__extended_8h_html_a124f2669c375fa66dc746be591ca2404"><div class="ttname"><a href="p4est__extended_8h.html#a124f2669c375fa66dc746be591ca2404">p4est_partition_ext</a></div><div class="ttdeci">p4est_gloidx_t p4est_partition_ext(p4est_t *p4est, int partition_for_coarsening, p4est_weight_t weight_fn)</div><div class="ttdoc">Repartition the forest.</div></div>
<div class="ttc" id="ap4est__extended_8h_html_a666a197be8d6d83c08cc14bfdc8565ed"><div class="ttname"><a href="p4est__extended_8h.html#a666a197be8d6d83c08cc14bfdc8565ed">p4est_balance_ext</a></div><div class="ttdeci">void p4est_balance_ext(p4est_t *p4est, p4est_connect_type_t btype, p4est_init_t init_fn, p4est_replace_t replace_fn)</div><div class="ttdoc">2:1 balance the size differences of neighboring elements in a forest.</div></div>
<div class="ttc" id="ap4est__extended_8h_html_aad32df9df3630b6bac05e7366a5f1e46"><div class="ttname"><a href="p4est__extended_8h.html#aad32df9df3630b6bac05e7366a5f1e46">p4est_refine_ext</a></div><div class="ttdeci">void p4est_refine_ext(p4est_t *p4est, int refine_recursive, int maxlevel, p4est_refine_t refine_fn, p4est_init_t init_fn, p4est_replace_t replace_fn)</div><div class="ttdoc">Refine a forest with a bounded refinement level and a replace option.</div></div>
<div class="ttc" id="ap4est__extended_8h_html_ac11cf572e8ac72c4beb78465f98b63f3"><div class="ttname"><a href="p4est__extended_8h.html#ac11cf572e8ac72c4beb78465f98b63f3">p4est_new_ext</a></div><div class="ttdeci">p4est_t * p4est_new_ext(sc_MPI_Comm mpicomm, p4est_connectivity_t *connectivity, p4est_locidx_t min_quadrants, int min_level, int fill_uniform, size_t data_size, p4est_init_t init_fn, void *user_pointer)</div><div class="ttdoc">Create a new forest.</div></div>
<div class="ttc" id="ap4est__geometry_8h_html_a699f3bd91e2560abeafc23322e12f0c3"><div class="ttname"><a href="p4est__geometry_8h.html#a699f3bd91e2560abeafc23322e12f0c3">p4est_geometry_transform_coordinates</a></div><div class="ttdeci">void p4est_geometry_transform_coordinates(p4est_geometry_t *geom, p4est_topidx_t which_tree, p4est_qcoord_t coords_in[2], double coords_out[3])</div><div class="ttdoc">Transform a quadrant reference coordinate into the geometry.</div></div>
<div class="ttc" id="ap4est__iterate_8h_html_aca75de06c7e9f039fa3be925a6ae87b4"><div class="ttname"><a href="p4est__iterate_8h.html#aca75de06c7e9f039fa3be925a6ae87b4">p4est_iterate</a></div><div class="ttdeci">void p4est_iterate(p4est_t *p4est, p4est_ghost_t *ghost_layer, void *user_data, p4est_iter_volume_t iter_volume, p4est_iter_face_t iter_face, p4est_iter_corner_t iter_corner)</div><div class="ttdoc">Execute user supplied callbacks at every volume, face, and corner in the local forest.</div></div>
<div class="ttc" id="ap4est__iterate_8h_html_adb709fe6510c4f0b3a918d2f976dbfbc"><div class="ttname"><a href="p4est__iterate_8h.html#adb709fe6510c4f0b3a918d2f976dbfbc">p4est_iter_volume_t</a></div><div class="ttdeci">void(* p4est_iter_volume_t)(p4est_iter_volume_info_t *info, void *user_data)</div><div class="ttdoc">The prototype for a function that p4est_iterate will execute at every quadrant local to the current p...</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:62</div></div>
<div class="ttc" id="ap4est__vtk_8h_html"><div class="ttname"><a href="p4est__vtk_8h.html">p4est_vtk.h</a></div><div class="ttdoc">Routines for printing a forest and associated fields to VTK format.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a17ce523f11f580944630c6c604a070da"><div class="ttname"><a href="p4est__vtk_8h.html#a17ce523f11f580944630c6c604a070da">p4est_vtk_write_header</a></div><div class="ttdeci">p4est_vtk_context_t * p4est_vtk_write_header(p4est_vtk_context_t *cont)</div><div class="ttdoc">Write the VTK header.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a23950ebd8b9b99877fa152752b5150d4"><div class="ttname"><a href="p4est__vtk_8h.html#a23950ebd8b9b99877fa152752b5150d4">p4est_vtk_write_footer</a></div><div class="ttdeci">int p4est_vtk_write_footer(p4est_vtk_context_t *cont)</div><div class="ttdoc">Write the VTU footer and clean up.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a34dbafa8dbc61172ead1a4da4c7103ca"><div class="ttname"><a href="p4est__vtk_8h.html#a34dbafa8dbc61172ead1a4da4c7103ca">p4est_vtk_context_new</a></div><div class="ttdeci">p4est_vtk_context_t * p4est_vtk_context_new(p4est_t *p4est, const char *filename)</div><div class="ttdoc">The first call to write a VTK file using individual functions.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a737397caa2806babf0d501c03b918a23"><div class="ttname"><a href="p4est__vtk_8h.html#a737397caa2806babf0d501c03b918a23">p4est_vtk_write_cell_data</a></div><div class="ttdeci">p4est_vtk_context_t * p4est_vtk_write_cell_data(p4est_vtk_context_t *cont, int write_tree, int write_level, int write_rank, int wrap_rank, int num_cell_scalars, int num_cell_vectors, const char *fieldnames[], sc_array_t *values[])</div><div class="ttdoc">Write VTK cell data.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_a78d37feae8abed0901541feab1247b87"><div class="ttname"><a href="p4est__vtk_8h.html#a78d37feae8abed0901541feab1247b87">p4est_vtk_context_set_geom</a></div><div class="ttdeci">void p4est_vtk_context_set_geom(p4est_vtk_context_t *cont, p4est_geometry_t *geom)</div><div class="ttdoc">Modify the geometry transformation registered in the context.</div></div>
<div class="ttc" id="ap4est__vtk_8h_html_aec7e360e192839f06f58cbfc7afb6d6c"><div class="ttname"><a href="p4est__vtk_8h.html#aec7e360e192839f06f58cbfc7afb6d6c">p4est_vtk_context_t</a></div><div class="ttdeci">struct p4est_vtk_context p4est_vtk_context_t</div><div class="ttdoc">Opaque context type for writing VTK output with multiple function calls.</div><div class="ttdef"><b>Definition:</b> p4est_vtk.h:42</div></div>
<div class="ttc" id="ap8est__bits_8h_html"><div class="ttname"><a href="p8est__bits_8h.html">p8est_bits.h</a></div><div class="ttdoc">Routines for manipulating quadrants (neighbors, parents, children, etc.)</div></div>
<div class="ttc" id="ap8est__communication_8h_html"><div class="ttname"><a href="p8est__communication_8h.html">p8est_communication.h</a></div><div class="ttdoc">Parallel messaging and support code.</div></div>
<div class="ttc" id="ap8est__extended_8h_html"><div class="ttname"><a href="p8est__extended_8h.html">p8est_extended.h</a></div><div class="ttdoc">Interface routines with extended capabilities.</div></div>
<div class="ttc" id="ap8est__vtk_8h_html"><div class="ttname"><a href="p8est__vtk_8h.html">p8est_vtk.h</a></div><div class="ttdoc">Routines for printing a forest and associated fields to VTK format.</div></div>
<div class="ttc" id="astructp4est__iter__volume__info_html"><div class="ttname"><a href="structp4est__iter__volume__info.html">p4est_iter_volume_info</a></div><div class="ttdoc">The information that is available to the user-defined p4est_iter_volume_t callback function.</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:47</div></div>
<div class="ttc" id="astructp4est__iter__volume__info_html_a1e9040be1cad1838d0407c1cc01e5122"><div class="ttname"><a href="structp4est__iter__volume__info.html#a1e9040be1cad1838d0407c1cc01e5122">p4est_iter_volume_info::quad</a></div><div class="ttdeci">p4est_quadrant_t * quad</div><div class="ttdoc">the quadrant of the callback</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:50</div></div>
<div class="ttc" id="astructp4est__iter__volume__info_html_aa9203b989bb29cc3ff536dd224727ab4"><div class="ttname"><a href="structp4est__iter__volume__info.html#aa9203b989bb29cc3ff536dd224727ab4">p4est_iter_volume_info::treeid</a></div><div class="ttdeci">p4est_topidx_t treeid</div><div class="ttdoc">the tree containing quad</div><div class="ttdef"><b>Definition:</b> p4est_iterate.h:53</div></div>
<div class="ttc" id="astructp4est__quadrant_html"><div class="ttname"><a href="structp4est__quadrant.html">p4est_quadrant</a></div><div class="ttdoc">The 2D quadrant datatype.</div><div class="ttdef"><b>Definition:</b> p4est.h:76</div></div>
<div class="ttc" id="astructp4est__quadrant_html_a0f92ad9bd71d9e3f82246d2768ff23ad"><div class="ttname"><a href="structp4est__quadrant.html#a0f92ad9bd71d9e3f82246d2768ff23ad">p4est_quadrant::level</a></div><div class="ttdeci">int8_t level</div><div class="ttdoc">level of refinement</div><div class="ttdef"><b>Definition:</b> p4est.h:80</div></div>
<div class="ttc" id="astructp4est__quadrant_html_a84896efd4c9ace3225253e379fb48a6e"><div class="ttname"><a href="structp4est__quadrant.html#a84896efd4c9ace3225253e379fb48a6e">p4est_quadrant::p</a></div><div class="ttdeci">union p4est_quadrant::p4est_quadrant_data p</div><div class="ttdoc">a union of additional data attached to a quadrant</div></div>
<div class="ttc" id="astructp4est__tree_html"><div class="ttname"><a href="structp4est__tree.html">p4est_tree</a></div><div class="ttdoc">The p4est tree datatype.</div><div class="ttdef"><b>Definition:</b> p4est.h:129</div></div>
<div class="ttc" id="astructp4est__tree_html_aa17e5be92cc11b1f53f31a8174c19345"><div class="ttname"><a href="structp4est__tree.html#aa17e5be92cc11b1f53f31a8174c19345">p4est_tree::quadrants</a></div><div class="ttdeci">sc_array_t quadrants</div><div class="ttdoc">locally stored quadrants</div><div class="ttdef"><b>Definition:</b> p4est.h:130</div></div>
<div class="ttc" id="astructp4est__tree_html_ab0248e174f0d63c76bbe1ba955f732be"><div class="ttname"><a href="structp4est__tree.html#ab0248e174f0d63c76bbe1ba955f732be">p4est_tree::quadrants_offset</a></div><div class="ttdeci">p4est_locidx_t quadrants_offset</div><div class="ttdoc">cumulative sum over earlier trees on this processor (locals only)</div><div class="ttdef"><b>Definition:</b> p4est.h:133</div></div>
<div class="ttc" id="astructp4est_html"><div class="ttname"><a href="structp4est.html">p4est</a></div><div class="ttdoc">The p4est forest datatype.</div><div class="ttdef"><b>Definition:</b> p4est.h:150</div></div>
<div class="ttc" id="astructp4est_html_a486eacc9c8e6ce28ff34429d297e703f"><div class="ttname"><a href="structp4est.html#a486eacc9c8e6ce28ff34429d297e703f">p4est::user_pointer</a></div><div class="ttdeci">void * user_pointer</div><div class="ttdoc">convenience pointer for users, never touched by p4est</div><div class="ttdef"><b>Definition:</b> p4est.h:157</div></div>
<div class="ttc" id="aunionp4est__quadrant_1_1p4est__quadrant__data_html_aff6684573d249ebf6af9f035aff5e1a0"><div class="ttname"><a href="unionp4est__quadrant_1_1p4est__quadrant__data.html#aff6684573d249ebf6af9f035aff5e1a0">p4est_quadrant::p4est_quadrant_data::user_data</a></div><div class="ttdeci">void * user_data</div><div class="ttdoc">never changed by p4est</div><div class="ttdef"><b>Definition:</b> p4est.h:94</div></div>
</div><!-- fragment --> </div><!-- contents -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
</body>
</html>
