<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>p4est: The connectivity structure</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">p4est
   &#160;<span id="projectnumber">2.8.7</span>
   </div>
   <div id="projectbrief">p4est is a software library for parallel adaptive mesh refinement.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">The connectivity structure </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>An overview of the connectivity structure.</p>
<h2><a class="anchor" id="autotoc_md0"></a>
The basic idea and definition</h2>
<p><a class="el" href="structp4est.html" title="The p4est forest datatype.">p4est</a> leverages structured octree grids for efficient highly-scalable adaptive mesh refinement (AMR). At the same time <a class="el" href="structp4est.html" title="The p4est forest datatype.">p4est</a> enables the user to represent a general and possibly non-squared (2D), non-cubic (3D) domain. This flexibility for the domain choice is achieved by using a forest of quadtrees (2D) or octrees (3D) instead of a single tree. The forest represents a coarse mesh topology where each tree is a logical hypercube. To represent a general domain, we cover the domain with a conforming mesh of (potentially mapped) squares (2D) or cubes (3D). Each square (2D) or cube (3D) represents a quadtree (2D) or octree (3D) root. These trees are connected with respect to their root's topological entities, i.e. in 2D corners and faces and in 3D corners, faces and edges. This coarsest possible mesh is defined as the connectivity of a forest. It can not be changed during a simulation and in particular it can not be coarsened further.</p>
<h2><a class="anchor" id="autotoc_md1"></a>
Guidelines for connectivity design</h2>
<p>Since the connectivity can not be changed during a simulation it should be designed carefully. A few guidelines (replace cube(s) by square(s) for 2D) are:</p><ol type="1">
<li>Use as many cubes as needed to capture the domain's topology (connected components, holes, tunnels, etc.).</li>
<li>Invest some more cubes to achieve an ideally uniform individual aspect ratio of each cube.</li>
<li>Invest some more cubes if the distortion in any single mapped octree appears too large.</li>
<li>Reduce the number of trees if the coarse mesh must be limited for numerical reasons.</li>
</ol>
<p>We have successfully connected millions of trees. Below 100k, there is no need to even think about reducing their number if the procedure would not be obvious.</p>
<h2><a class="anchor" id="autotoc_md2"></a>
Constructing the connectivity</h2>
<p>The easiest way to create a connectivity is to use one of the predefined functions in <a class="el" href="p4est__connectivity_8h.html">p4est_connectivity.h</a> (2D) or <a class="el" href="p8est__connectivity_8h.html">p8est_connectivity.h</a> (3D). These predefined functions <code>p4est_connectivity_new_*</code> (2D) and <code>p8est_connectivity_new_*</code> (3D) implement some basic connectivities like a unit square (<a class="el" href="p4est__connectivity_8h.html#aab03936b137ccdc4fa7520e7e017fcf0">p4est_connectivity_new_unitsquare</a>) or a unit cube (<a class="el" href="p8est__connectivity_8h.html#a53bdb596e76c52c1e23aaecd0aacc763">p8est_connectivity_new_unitcube</a>) but also more advanced connectivities like an icosahedron (<a class="el" href="p4est__connectivity_8h.html#a22189ecf16818e0ad94f7be8070027d1">p4est_connectivity_new_icosahedron</a>) or a 3D torus (<a class="el" href="p8est__connectivity_8h.html#aa50117d066094039f84db7e27600d0a9">p8est_connectivity_new_torus</a>).</p>
<p>Moreover, we want to point to the possibility of connecting topological entities inside a single tree. This means that one can create periodic connectivities, e.g. <a class="el" href="p4est__connectivity_8h.html#ae65fe72b77b6f6c6825fc33efc101dab">p4est_connectivity_new_periodic</a> (2D) and <a class="el" href="p8est__connectivity_8h.html#a1374c4c2fc06e436e047d32c28b87288">p8est_connectivity_new_periodic</a> (3D).</p>
<p>We also offer the functions <a class="el" href="p4est__connectivity_8h.html#af3521f9ecb47a49eefec6077fd97429c">p4est_connectivity_read_inp</a> (2D) and <a class="el" href="p8est__connectivity_8h.html#a323fe9836afb429b60a8b06ff0f6c08c">p8est_connectivity_read_inp</a> (3D) to read a connectivity from an Abaqus <code>.inp</code> file.</p>
<p>The user can also create a new connectivity by allocating and populating the connectivity structure using <a class="el" href="p4est__connectivity_8h.html#aee6fba5010f5af2b14833987b29dee23">p4est_connectivity_new_copy</a> (2D) or <a class="el" href="p8est__connectivity_8h.html#a32ba2ce6d92b624180275f844e061a8f">p8est_connectivity_new_copy</a> (3D). See the next section and <a class="el" href="p4est__connectivity_8h.html#a7bfc76825a73a3764b063ef476ed62f3">p4est_connectivity_t</a> (2D) or <a class="el" href="p8est__connectivity_8h.html#ae35f889062e2e420a5534facd7aaf6a0">p8est_connectivity_t</a> (3D) for more information on the elements of the connectivity structure.</p>
<h3><a class="anchor" id="autotoc_md3"></a>
Reducing storage size on shared-memory nodes</h3>
<p>Since the connectivity must be identical on every process, it is sufficient to generate it once on every shared memory node and share its contents using MPI3 functionality. We provide the function <a class="el" href="p4est__connectivity_8h.html#afbf34f950b045fb2b4b29440da487660">p4est_connectivity_share</a> for this purpose. Prior to calling it, the user may make the connectivity available on every first rank of every shared-memory node, for example using <a class="el" href="p4est__connectivity_8h.html#ae75350b07743b53c0af735c7683660b4">p4est_connectivity_bcast</a> over a communicator that contains these first ranks only.</p>
<p>For convenience, we integrate this approach in <a class="el" href="p4est__connectivity_8h.html#a8368869b9ad93ec9b399ecbb2a795fb9">p4est_connectivity_mission</a>. It requires to input a connectivity on just the root of the world communicatior and then distributes it using MPI-3 shared memory. This function uses safe fallbacks when MPI-3 is not detected on configuration, or when we compile entirely without MPI.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
The connectivity data structure</h2>
<p>The connectivity data structure (cf. <a class="el" href="p4est__connectivity_8h.html#a7bfc76825a73a3764b063ef476ed62f3">p4est_connectivity_t</a> (2D), <a class="el" href="p8est__connectivity_8h.html#ae35f889062e2e420a5534facd7aaf6a0">p8est_connectivity_t</a> (3D)) is a public struct with documented entries and it is independent of the MPI rank and hence must be the same on all MPI ranks.</p>
<p>You may build any numbers of forests with the same connectivity object, but the connectivity object must be destroyed only after the last of the forests has been freed and the connectivity object must definitely be destroyed (<a class="el" href="p4est__connectivity_8h.html#a208e613cae5e1bd3baffb587387b672c">p4est_connectivity_destroy</a> (2D), <a class="el" href="p8est__connectivity_8h.html#a83dc515293fe5f7c82eade6e281a62ca">p8est_connectivity_destroy</a> (3D)).</p>
<h3><a class="anchor" id="autotoc_md5"></a>
Elements of the connectivity</h3>
<p>The connectivity data structure consists of arrays and counts of different entities. In particular, the connectivity data structure contains the number of trees <a class="el" href="structp4est__connectivity.html#a1068e552922e0e98a1f2477020392b25">num_trees</a> and the number of vertices <a class="el" href="structp4est__connectivity.html#a0894477852eb4b80afb6f90a941f4988">num_vertices</a>. The vertices are stored in the double array <a class="el" href="structp4est__connectivity.html#ae955f91894a96c94bb05dceb270ce58f">vertices</a>. It is important to note that the vertices are always points in the three-dimensional space; even in the <a class="el" href="p4est__connectivity_8h.html#a7bfc76825a73a3764b063ef476ed62f3">2D connectivity</a>. The <a class="el" href="structp4est__connectivity.html#ae955f91894a96c94bb05dceb270ce58f">vertices</a> are used to embed each tree into the three-dimensional space in the array <a class="el" href="structp4est__connectivity.html#a9ff441d9dcadc317d5acfdfdb73b0dd5">tree_to_vertex</a>. This embedding is for example used for visualization (cf. <a class="el" href="p4est__vtk_8h.html">p4est_vtk.h</a> (2D), <a class="el" href="p8est__vtk_8h.html">p8est_vtk.h</a> (3D)) or a custom transformation from tree-local coordinates to a user-defined physical space (cf. <a class="el" href="p4est__geometry_8h.html#af9ba2d7b679c66899ddb82c1623e7ce4">p4est_geometry_new_connectivity</a> (2D), <a class="el" href="p8est__geometry_8h.html#a358133eb3dada44e4f6868b6bfa93b01">p8est_geometry_new_connectivity</a> (3D)). The remaining counts in the connectivity structure are the number of different topological entities that help to define the coarse mesh: The <a class="el" href="structp4est__connectivity.html#a89a2d05fa39c9174d6b93012be4aa7c2">num_corners</a> is the number of corners that are not part of a face neighborhood (or edge neighborhood in <a class="el" href="structp8est__connectivity.html#a1c21655509afcffa03267f489f731609">3D</a>) but connect trees. Similarly, we have <a class="el" href="structp8est__connectivity.html#ab237b9a727bb52663ab58a5eeed8a439">num_edges</a> in addition in 3D &ndash; storing the number of edges that are not part of a face neighborhood but connect trees. Then arrays like <a class="el" href="structp4est__connectivity.html#abd359ad4f42fa6f3bef058c5fbdebf5a">tree_to_tree</a> and <a class="el" href="structp4est__connectivity.html#a1cdfd9e7d8bc9ccab32a2e389c2ea231">tree_to_face</a> encode the inter-tree connectivity information. For more information of the encoding in these arrays and the other arrays see the documentation of <a class="el" href="p4est__connectivity_8h.html#a7bfc76825a73a3764b063ef476ed62f3">p4est_connectivity_t</a> (2D) and <a class="el" href="p8est__connectivity_8h.html#ae35f889062e2e420a5534facd7aaf6a0">p8est_connectivity_t</a> (3D) and the documentation of the respective elements of these two structures.</p>
<h2><a class="anchor" id="autotoc_md6"></a>
Find more information</h2>
<p>For information on further connectivity functionalities we refer to <a class="el" href="p4est__connectivity_8h.html">p4est_connectivity.h</a> (2D) and <a class="el" href="p8est__connectivity_8h.html">p8est_connectivity.h</a> (3D). In particular, you can find there functions for <a class="el" href="p4est__connectivity_8h.html#af8be3fd9a6c96e3e2a710f9251952cf3">writing</a> and <a class="el" href="p4est__connectivity_8h.html#a4d8d6cb8fd999dd939bdf1159d3e2723">reading</a> a connectivity in a <a class="el" href="structp4est.html" title="The p4est forest datatype.">p4est</a> internal file format. There are also functions to manipulate connectivity objects, e.g. one can use METIS &ndash; if it is available &ndash; to <a class="el" href="p4est__connectivity_8h.html#a6fa55094144a0dc59e8dfc16cf33caf0">reorder</a> a connectivity.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
Example of connectivity usage</h2>
<p>An example of using various predefined connectivities can be found in <a class="el" href="simple_2simple2_8c-example.html">simple/simple2.c</a> (2D) and <a class="el" href="simple_2simple3_8c-example.html">simple/simple3.c</a> (3D). </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
<!-- HTML footer for doxygen 1.8.13-->
<!-- start footer part -->
<hr class="footer"/>
</body>
</html>
